include ../test
include ../common

div.container.table-responsive(ng-controller='ReportOverviewCtrl')

    mixin test

    ul.nav.nav-tabs
        li.active
            a(href='#/report?build={{query.build}}') Overview
        li
            a(href='#/report/yslow?build={{query.build}}') YSlow
        li
            a(href='#/report/dommonster?build={{query.build}}') DomMonster

        div.btn-group(data-toggle="buttons")
            label.btn.btn-primary.active(ng-click="setReportView('table')")
                input(type="radio")
                |Report view
            label.btn.btn-primary(ng-click="setReportView('chart')")
                input(type="radio")
                |Chart view


    div#chartArea(ng-hide="reportView !== 'chart'")
        div.col-md-6(ng-repeat="f in fields")
            div.panel.panel-default
                div.panel-heading {{f.name}}
                    |&nbsp;
                    select(ng-model="charts[f.tool].xAxis",ng-options="c.name for c in charts.options")

                div.panel-body
                    div(id="{{f.tool}}Chart").pivotChart

    div(ng-hide="reportView === 'chart'")
        table#results.table.table-striped
            thead
                tr
                    th
                    th URL
                    th Date
                    th Build
                    th Tag
                    th.text-center Load time
                    th.text-center YSlow
                    th.text-center DomMonster
                    th.text-center Validator
            tbody
                tr.warning
                    td
                    td(data-sort="a")
                        a(href='#/report?build={{query.build}}',ng-if='query.url') {{query.url.substr(0,20)}}...
                    td
                    td
                        a(href='#/report?url={{query.url}}',ng-if='query.build') {{query.build.substr(0,6)}}...
                    td
                    td(ng-repeat='f in fields').text-center
                        span(class="label label-{{totals[f.tool][f.metric].class}}") {{totals[f.tool][f.metric].message}} ({{totals[f.tool][f.metric].score}}%)
                    td.text-center

                tr(ng-if="results.length === 0 && testing")
                    td(colspan="7")
                        img(src="/images/ajax-loader.gif")

                tr(ng-repeat='r in results')
                    td
                        a(href='#/detail/:{{r._id}}')
                            button.btn.btn-default(type='button')
                                span.glyphicon.glyphicon-list-alt
                    td
                        a(href='#/report?url={{r.url}}&build={{query.build}}') {{r.url}}
                    td {{r.timestamp | date:'shortDate'}}
                    td
                        a(href='#/report?build={{r.build}}&url={{query.url}}') {{r.build.substr(0,6)}}...
                    td {{r.tag}}
                    td(ng-repeat='f in fields',class='text-center grade{{r.metrics[f.tool].grades[f.metric]}}',data-type='grades',ng-mouseenter='setPopoverContent(r.metrics[f.tool])',ng-mouseleave='setPopoverContent()')
                        span.badge {{r.metrics[f.tool].grades[f.metric]}}

                    td(class='text-center grade{{r.metrics.validator.grades.COMPOSITE_info}}',data-type='grades',ng-mouseenter='setPopoverContent(r.metrics.validator)',ng-mouseleave='setPopoverContent()')
                        span.badge {{r.metrics.validator.grades.COMPOSITE_info}}

            tfoot
                tr.warning
                    td
                    td
                        a(href='#/report?build={{query.build}}',ng-if='query.url') {{query.url.substr(0,20)}}...
                    td
                    td
                        a(href='#/report?url={{query.url}}',ng-if='query.build') {{query.build.substr(0,6)}}...
                    td
                    td(ng-repeat='f in fields').text-center
                        span(class="label label-{{totals[f.tool][f.metric].class}}") {{totals[f.tool][f.metric].message}} ({{totals[f.tool][f.metric].score}}%)
                    td.text-center

        div#popoverContent.ng-hide
            ul.list-group(ng-if='popoverContent.tool === "time"')
                li(class='list-group-item grade{{popoverContent.grades.lt}}') {{popoverContent.data.lt/1000}} s&nbsp;
                    span(class='badge') {{popoverContent.grades.lt}}
            ul.list-group(ng-if='popoverContent.tool === "yslow"')
                li(class='list-group-item grade{{popoverContent.grades.o}}') Overall&nbsp;
                    span(class='badge') {{popoverContent.grades.o}}
                li.list-group-item Page Size&nbsp;
                    span(class='badge grade{{popoverContent.grades.w}}') {{popoverContent.grades.w}}
                li.list-group-item Page Size (cached)&nbsp;
                    span(class='badge grade{{popoverContent.grades.w_c}}') {{popoverContent.grades.w_c}}
                li.list-group-item Requests&nbsp;
                    span(class='badge grade{{popoverContent.grades.r}}') {{popoverContent.grades.r}}
                li.list-group-item Requests (cached)&nbsp;
                    span(class='badge grade{{popoverContent.grades.r_c}}') {{popoverContent.grades.r_c}}
                li.list-group-item Inline JS/CSS&nbsp;
                    span(class='badge grade{{popoverContent.grades.g.yminify}}') {{popoverContent.grades.g.yminify}}

            ul.list-group(ng-if='popoverContent.tool === "dommonster"')
                li(class='list-group-item grade{{popoverContent.grades.COMPOSITE_stats}}') Overall&nbsp;
                    span(class='badge') {{popoverContent.grades.COMPOSITE_stats}}


    //div#modalFilter.modal.fade(tabindex="-1",role="dialog",aria-labelledby="modalFilterLabel",aria-hidden="true")
        div.modal-dialog
            div.modal-content
                div.modal-header
                    button.close(type="button",data-dismiss="modal",aria-hidden="true")
                    h4.modal-title Filter report
                div.modal-body
                    form(role="form")
                        div.form-group
                            label(for="url") URL
                            input#url.form-control(name="url",placeholder="Enter a single URL to filter by",ng-model="query.url")
                        button.btn.btn-default(type="button",data-dismiss="modal") Cancel
                        button.btn.btn-primary(type="submit",data-dismiss="modal",ng-click="filter()") Go!
