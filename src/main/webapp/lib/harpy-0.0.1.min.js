var Harpy=function(){function e(c){k[c]="function"===typeof Harpy[c]?Harpy[c](k):Harpy[c];return k[c]}function c(c){e(c);Harpy[c]=null;delete Harpy[c]}var k={};return{Viewer:null,Comparator:null,init:function(){c("util");c("render");c("harpify");Harpy.Viewer=e("Viewer");Harpy.Comparator=e("Comparator");Harpy.init=null;delete Harpy.init}}}();
Harpy.Comparator=function(e){return function(c,k){function g(){e.render.drawPieCharts(l,d,f);e.render.drawBarChart(l,m);e.render.drawBarChart(l,n);e.render.drawBarChart(l,p)}c=JSON.parse(c);k=JSON.parse(k);var h=e.harpify(c),a=e.harpify(k),d=h.stats,f=a.stats,l,h=["Metric","Primed cache","Uncached"],m=[h,["Dom load",d.timing.onContentLoad/1E3,f.timing.onContentLoad/1E3],["Load",d.timing.onLoad/1E3,f.timing.onLoad/1E3],["Total",d.timing.total/1E3,f.timing.total/1E3]],n=[h,["Requests",d.requests.uncached,
    f.requests.uncached]],p=[h,["Size",d.size.download/1024,f.size.download/1024]];this.draw=function(a){this.el=l=a;google.visualization?g():(google.load("visualization","1",{packages:["corechart"]}),google.setOnLoadCallback(g));return this}}};
Harpy.Viewer=function(e){return function(c){function k(){var d=$("#"+a+" th.timeline").width()/c.log.pages[0].harpy_info.time.total,n=$("#"+a+" table.harpy div"),f=$("#"+a+" table.harpy div.loadMarker"),g=$("#"+a+" table.harpy>tbody").height()+"px";n.each(function(){this.hasAttribute("data-start")&&(this.style.marginLeft=e.util.unitise(this,"data-start",d)+"px");this.hasAttribute("data-time")&&(this.style.width=e.util.unitise(this,"data-time",d)+"px")});f.each(function(){var a=0,c=0;this.hasAttribute("data-dom")&&
(a=e.util.unitise(this,"data-dom",d));this.hasAttribute("data-page")&&(c=e.util.unitise(this,"data-page",d)-a);this.style.marginLeft=a+"px";this.style.width=c+"px";this.style.height=g})}function g(){e.render.drawPieCharts(a,l)}var h=this,a=null;c=JSON.parse(c);var d=e.harpify(c);c=d.har;var f=d.entryCache,l=d.stats;this.resize=k;this.showInfo=function(a){var c=a.getAttribute("data-id"),c=f[c];if(c.info)c.info.style.display="none"===c.info.style.display?"table-row":"none",k();else{var d=document.createElement("TR");
    d.innerHTML=Harpy.Templates.info(c);$(a).after(d);c.info=d;k();return a}};this.draw=function(d){this.el=a=d;google.visualization?g():(google.load("visualization","1",{packages:["corechart"]}),google.setOnLoadCallback(g));d={};d["#"+a+" table.harpy>tbody>tr"]={click:function(a,d){h.showInfo(d)}};h.behaviours=[d,{window:{resize:function(){h.resize()}}}];Exos.enable(h.behaviours);Handlebars.registerHelper("trimmer",e.util.trimmer);Handlebars.registerHelper("format",e.util.format);Handlebars.registerPartial("timeline",
    Harpy.Templates.timeline);d=document.createElement("TABLE");d.innerHTML=Harpy.Templates.data(c);d.className="harpy";document.getElementById(a)&&document.getElementById(a).appendChild(d);setTimeout(this.resize,1);$.tablesorter&&$(d).tablesorter({sortList:[[0,0]]});return this};this.destroy=function(){Exos.remove(h.behaviours)}}};
Harpy.harpify=function(e){return function(c){var k={},g;g={time:{blocked:0,dns:0,connect:0,send:0,wait:0,receive:0},type:{image:0,html:0,js:0,css:0,text:0,other:0},uncached:{image:0,html:0,js:0,css:0,text:0,other:0},size:{cache:0,download:0},requests:{cached:0,uncached:0},timing:{onContentLoad:0,onLoad:0,total:0}};var h=c.log.pages[0].pageTimings;g.timing.onLoad=h.onLoad;g.timing.total=h.onLoad;g.timing.onContentLoad=h.onContentLoad||h.onLoad;var a=new Date(c.log.pages[0].startedDateTime),d,f,l,m,
    n,p,q=c.log.entries[0].request.url.split("://");q[1]&&(q=q[0]+"://"+q[1].split("/")[0]);for(d=0;d<c.log.entries.length;d++){f=c.log.entries[d];f.harpy_info={};k[d]=f;l=f.request.url;f.harpy_info.source=-1<l.indexOf(q)?"internal":"external";0<d&&(l=l.replace(c.log.entries[0].request.url,""));m=e.util.getMimetype(f.response.content.mimeType);n=(new Date(f.startedDateTime)).getTime()+f.time;n>a.getTime()+h.total&&(g.timing.total=n-a);for(p in f.timings)f.timings.hasOwnProperty(p)&&0<f.timings[p]&&(g.time[p]+=
    f.timings[p]);g.type[m]+=f.response.bodySize;g.uncached[m]+=f.response.bodySize;g.size.download+=f.response.bodySize;f.harpy_info.index=d+1;f.harpy_info.url=l;f.harpy_info.mimetype=m;"(cache)"===f.response.status?(f.harpy_info.cache="cache",g.requests.cached+=1):g.requests.uncached+=1;f.cache.hasOwnProperty("afterRequest")?(g.size.cache+=f.response.content.size,g.type[m]+=f.response.content.size,f.harpy_info.size=f.response.content.size):f.harpy_info.size=f.response.bodySize;f.harpy_info.startTime=
    new Date(f.startedDateTime)-a}h={};h.time=g.timing;h.size=g.size;c.log.pages[0].harpy_info=h;return{har:c,stats:g,entryCache:k}}};
Harpy.render=function(){var e={pieSliceTextStyle:{color:"#000"},chartArea:{top:30,left:10,bottom:30,right:10,width:300},diff:{oldData:{opacity:0.7}}},c={time:{colors:"#d9534f #F63 #F96 #9C9 #FC6 #5cb85c".split(" "),title:"Time"},type:{colors:["#CCC","#FFB","#FBF","#BBF","#FBB"],title:"Content"},uncached:{colors:["#CCC","#FFB","#FBF","#BBF","#FBB"],title:"Uncached content"},size:{colors:["#5cb85c","#d9534f"],title:"Cache profile"}};return{standardConfig:e,chartConfigs:c,drawPieCharts:function(k,g,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 h){var a,d,f,l,m,n,p,q,b=[];for(a in g)if(g.hasOwnProperty(a)&&c[a]){d=g[a];l=[["",""]];h&&(f=h[a],m=[["",""]]);for(n in d)d.hasOwnProperty(n)&&(l[l.length]=[n,0>d[n]?0:d[n]],f&&f.hasOwnProperty(n)&&(m[m.length]=[n,0>f[n]?0:f[n]]));for(p in e)e.hasOwnProperty(p)&&(c[a][p]=e[p]);d=document.createElement("DIV");d.className="harpyChart";document.getElementById(k)&&document.getElementById(k).appendChild(d);l=google.visualization.arrayToDataTable(l);q=new google.visualization.PieChart(d);h&&(d=google.visualization.arrayToDataTable(m),
    l=q.computeDiff(d,l));q.draw(l,c[a]);b[b.length]=q}return b},drawBarChart:function(c,e){var h=document.createElement("DIV");h.className="harpyChart harpyBarChart";document.getElementById(c)&&document.getElementById(c).appendChild(h);var a=google.visualization.arrayToDataTable(e),h=new google.visualization.BarChart(h);h.draw(a,{colors:["#5cb85c","#d9534f"],legend:"none",hAxis:{maxValue:0}});return h}}}();
Harpy.util=function(){return{getMimetype:function(e){return-1!==e.indexOf("image")?"image":-1!==e.indexOf("html")?"html":-1!==e.indexOf("javascript")?"js":-1!==e.indexOf("css")?"css":-1!==e.indexOf("text")?"text":"other"},format:function(e,c){switch(c){case "size":return 1024<e?(e=Math.round(e/102.4),e/10+" KB"):e+" B";case "time":return 1E3<e?(e=Math.round(e/10),e/100+" s"):e+" ms"}return e},trimmer:function(e,c,k){var g=e.length>c?"...":"";return k?g+(e.length>c?e.substr(e.length-c):e):e.substr(0,
    c)+g},unitise:function(e,c,k){return Math.floor(Number(e.getAttribute(c))*k)}}}();Harpy.init();this.Harpy=this.Harpy||{};this.Harpy.Templates=this.Harpy.Templates||{};
this.Harpy.Templates.data=Handlebars.template(function(e,c,k,g,h){this.compilerInfo=[4,">= 1.0.0"];k=this.merge(k,e.helpers);g=this.merge(g,e.partials);h=h||{};var a,d,f=this.escapeExpression,l=k.helperMissing,m=this;e=""+('<thead>\r\n    <tr>\r\n        <th></th>\r\n        <th>Method</th>\r\n        <th>URL</th>\r\n        <th>Status</th>\r\n        <th>Type</th>\r\n        <th>Size</th>\r\n        <th class="timeline">\r\n            <div class="loadMarker" data-dom="'+f((a=(a=(a=(a=(a=(a=c&&c.log,
    null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onContentLoad),"function"===typeof a?a.apply(c):a))+'" data-page="'+f((a=(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onLoad),"function"===typeof a?a.apply(c):a))+'"></div>\r\n        </th>\r\n    </tr>\r\n</thead>\r\n<tbody>\r\n');if((d=k.each.call(c,(a=c&&c.log,
    null==a||!1===a?a:a.entries),{hash:{},inverse:m.noop,fn:m.program(1,function(a,d){var c,b,e;c=""+('\r\n    <tr data-id="'+f((b=(b=d,null==b||!1===b?b:b.index),"function"===typeof b?b.apply(a):b))+'" class="'+f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.mimetype),"function"===typeof b?b.apply(a):b))+" "+f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.cache),"function"===typeof b?b.apply(a):b))+" "+f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.source),"function"===typeof b?b.apply(a):b))+'">\r\n        <td>'+
        f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.index),"function"===typeof b?b.apply(a):b))+"</td>\r\n        <td>"+f((b=(b=a&&a.request,null==b||!1===b?b:b.method),"function"===typeof b?b.apply(a):b))+'</td>\r\n        <td class="url" title="'+f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.url),"function"===typeof b?b.apply(a):b))+'">');e={hash:{},data:d};c+=f((b=k.trimmer||a&&a.trimmer,b?b.call(a,(b=a&&a.harpy_info,null==b||!1===b?b:b.url),30,!0,e):l.call(a,"trimmer",(b=a&&a.harpy_info,null==b||!1===b?
        b:b.url),30,!0,e)))+'</td>\r\n        <td title="'+f((b=(b=a&&a.response,null==b||!1===b?b:b.status),"function"===typeof b?b.apply(a):b))+" "+f((b=(b=a&&a.response,null==b||!1===b?b:b.statusText),"function"===typeof b?b.apply(a):b))+'">'+f((b=(b=a&&a.response,null==b||!1===b?b:b.status),"function"===typeof b?b.apply(a):b))+'</td>\r\n        <td title="'+f((b=(b=(b=a&&a.response,null==b||!1===b?b:b.content),null==b||!1===b?b:b.mimeType),"function"===typeof b?b.apply(a):b))+'">'+f((b=(b=a&&a.harpy_info,
        null==b||!1===b?b:b.mimetype),"function"===typeof b?b.apply(a):b))+"</td>\r\n        <td>";e={hash:{},data:d};c+=f((b=k.format||a&&a.format,b?b.call(a,(b=a&&a.harpy_info,null==b||!1===b?b:b.size),"size",e):l.call(a,"format",(b=a&&a.harpy_info,null==b||!1===b?b:b.size),"size",e)))+'</td>\r\n        <td title="Blocked: '+f((b=(b=a&&a.timings,null==b||!1===b?b:b.blocked),"function"===typeof b?b.apply(a):b))+" ms, DNS: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.dns),"function"===typeof b?b.apply(a):b))+
        " ms, Connect: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.connect),"function"===typeof b?b.apply(a):b))+" ms, Send: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.send),"function"===typeof b?b.apply(a):b))+" ms, Wait: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.wait),"function"===typeof b?b.apply(a):b))+" ms, Receive: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.receive),"function"===typeof b?b.apply(a):b))+' ms">';if((b=m.invokePartial(g.timeline,"timeline",a,k,g,d))||0===b)c+=b;return c+"</td>\r\n    </tr>\r\n"},
    h),data:h}))||0===d)e+=d;e+='\r\n</tbody>\r\n<tfoot>\r\n    <tr class="total">\r\n        <td>'+f((a=(a=(a=c&&c.log,null==a||!1===a?a:a.entries),null==a||!1===a?a:a.length),"function"===typeof a?a.apply(c):a))+'</td>\r\n        <td colspan="4"></td>\r\n        <td>';d={hash:{},data:h};e+=f((a=k.format||c&&c.format,a?a.call(c,(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.download),"size",d):l.call(c,
    "format",(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.download),"size",d)))+"</td>\r\n        <td>\r\n            (";d={hash:{},data:h};e+=f((a=k.format||c&&c.format,a?a.call(c,(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.cache),"size",d):l.call(c,"format",(a=(a=(a=(a=(a=c&&c.log,null==
    a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.cache),"size",d)))+' from cache)\r\n            <span title="DOM: ';d={hash:{},data:h};e+=f((a=k.format||c&&c.format,a?a.call(c,(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onContentLoad),"time",d):l.call(c,"format",(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==
    a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onContentLoad),"time",d)))+", Page: ";d={hash:{},data:h};e+=f((a=k.format||c&&c.format,a?a.call(c,(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onLoad),"time",d):l.call(c,"format",(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===
    a?a:a.time),null==a||!1===a?a:a.onLoad),"time",d)))+'">';d={hash:{},data:h};return e+=f((a=k.format||c&&c.format,a?a.call(c,(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.total),"time",d):l.call(c,"format",(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.total),"time",d)))+"</span>\r\n        </td>\r\n    </tr>\r\n</tfoot>"});
this.Harpy.Templates.info=Handlebars.template(function(e,c,k,g,h){function a(a,c){var d,e;d="\r\n            <tr>\r\n                <td>";(e=k.name)?e=e.call(a,{hash:{},data:c}):(e=a&&a.name,e=typeof e===f?e.call(a,{hash:{},data:c}):e);d+=l(e)+"</td>\r\n                <td>";(e=k.value)?e=e.call(a,{hash:{},data:c}):(e=a&&a.value,e=typeof e===f?e.call(a,{hash:{},data:c}):e);return d+=l(e)+"</td>\r\n            </tr>\r\n        "}this.compilerInfo=[4,">= 1.0.0"];k=this.merge(k,e.helpers);h=h||{};var d,
    f="function",l=this.escapeExpression;e=""+('<td></td>\r\n<td class="info" colspan="6">\r\n    <a href="'+l((d=(d=(d=c&&c.entry,null==d||!1===d?d:d.request),null==d||!1===d?d:d.url),typeof d===f?d.apply(c):d))+'" target="_blank">\r\n        <strong>'+l((d=(d=c&&c.request,null==d||!1===d?d:d.url),typeof d===f?d.apply(c):d))+"</strong>\r\n    </a>\r\n    <br/>\r\n    "+l((d=(d=(d=c&&c.response,null==d||!1===d?d:d.content),null==d||!1===d?d:d.mimeType),typeof d===f?d.apply(c):d))+'\r\n    <hr/>\r\n    <strong>Timings</strong>\r\n    <dl>\r\n        <dt>Blocked</dt>\r\n        <dd class="blocked">'+
    l((d=(d=c&&c.timings,null==d||!1===d?d:d.blocked),typeof d===f?d.apply(c):d))+' ms</dd>\r\n        <dt>DNS</dt>\r\n        <dd class="dns">'+l((d=(d=c&&c.timings,null==d||!1===d?d:d.dns),typeof d===f?d.apply(c):d))+' ms</dd>\r\n        <dt>Connect</dt>\r\n        <dd class="connect">'+l((d=(d=c&&c.timings,null==d||!1===d?d:d.connect),typeof d===f?d.apply(c):d))+' ms</dd>\r\n        <dt>Send</dt>\r\n        <dd class="send">'+l((d=(d=c&&c.timings,null==d||!1===d?d:d.send),typeof d===f?d.apply(c):d))+
    ' ms</dd>\r\n        <dt>Wait</dt>\r\n        <dd class="wait">'+l((d=(d=c&&c.timings,null==d||!1===d?d:d.wait),typeof d===f?d.apply(c):d))+' ms</dd>\r\n        <dt>Receive</dt>\r\n        <dd class="receive">'+l((d=(d=c&&c.timings,null==d||!1===d?d:d.receive),typeof d===f?d.apply(c):d))+" ms</dd>\r\n    </dl>\r\n    <hr/>\r\n    <strong>Request headers</strong>\r\n    <table>\r\n        ");if((g=k.each.call(c,(d=c&&c.request,null==d||!1===d?d:d.headers),{hash:{},inverse:this.noop,fn:this.program(1,
    a,h),data:h}))||0===g)e+=g;e+="\r\n    </table>\r\n    <hr/>\r\n    <strong>Response headers</strong>\r\n    <table>\r\n        ";if((g=k.each.call(c,(d=c&&c.response,null==d||!1===d?d:d.headers),{hash:{},inverse:this.noop,fn:this.program(1,a,h),data:h}))||0===g)e+=g;return e+"\r\n    </table>\r\n    <hr/>\r\n</td>"});
this.Harpy.Templates.timeline=Handlebars.template(function(e,c,k,g,h){this.compilerInfo=[4,">= 1.0.0"];this.merge(k,e.helpers);var a;e=this.escapeExpression;return c=""+('<div class="blocked" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.blocked),"function"===typeof a?a.apply(c):a))+'" data-start="'+e((a=(a=c&&c.harpy_info,null==a||!1===a?a:a.startTime),"function"===typeof a?a.apply(c):a))+'"></div>\r\n<div class="dns" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.dns),"function"===
    typeof a?a.apply(c):a))+'"></div>\r\n<div class="connect" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.connect),"function"===typeof a?a.apply(c):a))+'"></div>\r\n<div class="send" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.send),"function"===typeof a?a.apply(c):a))+'"></div>\r\n<div class="wait" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.wait),"function"===typeof a?a.apply(c):a))+'"></div>\r\n<div class="receive" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.receive),
    "function"===typeof a?a.apply(c):a))+'"></div>')});
