var Harpy=function(){function e(a,d){switch(d){case "size":return 1024<a?(a=Math.round(a/102.4),a/10+" KB"):a+" B";case "time":return 1E3<a?(a=Math.round(a/10),a/100+" s"):a+" ms"}return a}function c(a,d,c){var g=a.length>d?"...":"";return c?g+(a.length>d?a.substr(a.length-d):a):a.substr(0,d)+g}function h(c,e,s){var g,p,l,b,r,m,h,k;for(g in e)if(e.hasOwnProperty(g)&&d[g]){p=e[g];b=[["",""]];s&&(l=s[g],r=[["",""]]);for(m in p)p.hasOwnProperty(m)&&(b[b.length]=[m,0>p[m]?0:p[m]],l&&l.hasOwnProperty(m)&&
(r[r.length]=[m,0>l[m]?0:l[m]]));for(h in a)a.hasOwnProperty(h)&&(d[g][h]=a[h]);p=document.createElement("DIV");p.className="harpyChart";document.getElementById(c).appendChild(p);b=google.visualization.arrayToDataTable(b);k=new google.visualization.PieChart(p);s&&(p=google.visualization.arrayToDataTable(r),b=k.computeDiff(p,b));k.draw(b,d[g])}}function n(a,d){var c=document.createElement("DIV");c.className="harpyChart harpyBarChart";document.getElementById(a).appendChild(c);var g=google.visualization.arrayToDataTable(d);
(new google.visualization.BarChart(c)).draw(g,{colors:["#5cb85c","#d9534f"],legend:"none",hAxis:{maxValue:0}})}function k(a){var d={},c;c={time:{blocked:0,dns:0,connect:0,send:0,wait:0,receive:0},type:{image:0,html:0,js:0,css:0,text:0,other:0},uncached:{image:0,html:0,js:0,css:0,text:0,other:0},size:{cache:0,download:0},requests:{cached:0,uncached:0},timing:{onContentLoad:0,onLoad:0,total:0}};var g=a.log.pages[0].pageTimings;c.timing.onLoad=g.onLoad;c.timing.total=g.onLoad;c.timing.onContentLoad=
g.onContentLoad||g.onLoad;var e=new Date(a.log.pages[0].startedDateTime),l,b,h,m,k,n,t=a.log.entries[0].request.url.split("://");t[1]&&(t=t[0]+"://"+t[1].split("/")[0]);for(l=0;l<a.log.entries.length;l++){b=a.log.entries[l];b.harpy_info={};d[l]=b;h=b.request.url;b.harpy_info.source=-1<h.indexOf(t)?"internal":"external";0<l&&(h=h.replace(a.log.entries[0].request.url,""));m=b.response.content.mimeType;m=-1!==m.indexOf("image")?"image":-1!==m.indexOf("html")?"html":-1!==m.indexOf("javascript")?"js":
-1!==m.indexOf("css")?"css":-1!==m.indexOf("text")?"text":"other";k=(new Date(b.startedDateTime)).getTime()+b.time;k>e.getTime()+g.total&&(c.timing.total=k-e);for(n in b.timings)b.timings.hasOwnProperty(n)&&0<b.timings[n]&&(c.time[n]+=b.timings[n]);c.type[m]+=b.response.bodySize;c.uncached[m]+=b.response.bodySize;c.size.download+=b.response.bodySize;b.harpy_info.index=l+1;b.harpy_info.url=h;b.harpy_info.mimetype=m;"(cache)"===b.response.status?(b.harpy_info.cache="cache",c.requests.cached+=1):c.requests.uncached+=
1;b.cache.hasOwnProperty("afterRequest")?(c.size.cache+=b.response.content.size,c.type[m]+=b.response.content.size,b.harpy_info.size=b.response.content.size):b.harpy_info.size=b.response.bodySize;b.harpy_info.startTime=new Date(b.startedDateTime)-e}g={};g.time=c.timing;g.size=c.size;a.log.pages[0].harpy_info=g;return{har:a,stats:c,entryCache:d}}var a={pieSliceTextStyle:{color:"#000"},chartArea:{top:30,left:10,bottom:30,right:10,width:300},diff:{oldData:{opacity:0.7}}},d={time:{colors:"#d9534f #F63 #F96 #9C9 #FC6 #5cb85c".split(" "),
title:"Time"},type:{colors:["#CCC","#FFB","#FBF","#BBF","#FBB"],title:"Content"},uncached:{colors:["#CCC","#FFB","#FBF","#BBF","#FBB"],title:"Uncached content"},size:{colors:["#5cb85c","#d9534f"],title:"Cache profile"}};return{Viewer:function(a){function d(){function b(a,d){return Math.floor(Number(a.getAttribute(d))*c)}var c=$("#"+p+" th.timeline").width()/a.log.pages[0].harpy_info.time.total,g=$("#"+p+" table.harpy div"),l=$("#"+p+" table.harpy div.loadMarker"),e=$("#"+p+" table.harpy>tbody").height()+
"px";g.each(function(){this.hasAttribute("data-start")&&(this.style.marginLeft=b(this,"data-start")+"px");this.hasAttribute("data-time")&&(this.style.width=b(this,"data-time")+"px")});l.each(function(){var a=0,c=0;this.hasAttribute("data-dom")&&(a=b(this,"data-dom"));this.hasAttribute("data-page")&&(c=b(this,"data-page")-a);this.style.marginLeft=a+"px";this.style.width=c+"px";this.style.height=e})}function n(){h(p,r)}var g=this,p=null;a=JSON.parse(a);var l=k(a);a=l.har;var b=l.entryCache,r=l.stats;
this.resize=d;this.showInfo=function(a){var c=a.getAttribute("data-id"),c=b[c];if(c.info)c.info.style.display="none"===c.info.style.display?"table-row":"none";else{var g=document.createElement("TR");g.innerHTML=Harpy.Templates.info(c);$(a).after(g);c.info=g}d()};this.draw=function(b){this.el=p=b;google.visualization?n():(google.load("visualization","1",{packages:["corechart"]}),google.setOnLoadCallback(n));b={};b["#"+p+" table.harpy>tbody>tr"]={click:function(a,b){g.showInfo(b)}};g.behaviours=[b,
{window:{resize:function(){g.resize()}}}];Exos.enable(g.behaviours);Handlebars.registerHelper("trimmer",c);Handlebars.registerHelper("format",e);Handlebars.registerPartial("timeline",Harpy.Templates.timeline);b=document.createElement("TABLE");b.innerHTML=Harpy.Templates.data(a);b.className="harpy";document.getElementById(p).appendChild(b);setTimeout(this.resize,1);$.tablesorter&&$(b).tablesorter({sortList:[[0,0]]})};this.destroy=function(){Exos.remove(g.behaviours)}},Comparator:function(a,c){function d(){h(r,
l,b);n(r,m);n(r,u);n(r,v)}a=JSON.parse(a);c=JSON.parse(c);var g=k(a),e=k(c),l=g.stats,b=e.stats,r,g=["Metric","Primed cache","Uncached"],m=[g,["Dom load",l.timing.onContentLoad/1E3,b.timing.onContentLoad/1E3],["Load",l.timing.onLoad/1E3,b.timing.onLoad/1E3],["Total",l.timing.total/1E3,b.timing.total/1E3]],u=[g,["Requests",l.requests.uncached,b.requests.uncached]],v=[g,["Size",l.size.download/1024,b.size.download/1024]];this.draw=function(a){this.el=r=a;google.visualization?d():(google.load("visualization",
"1",{packages:["corechart"]}),google.setOnLoadCallback(d))}}}}();this.Harpy=this.Harpy||{};this.Harpy.Templates=this.Harpy.Templates||{};
this.Harpy.Templates.data=Handlebars.template(function(e,c,h,n,k){this.compilerInfo=[4,">= 1.0.0"];h=this.merge(h,e.helpers);n=this.merge(n,e.partials);k=k||{};var a,d,f=this.escapeExpression,q=h.helperMissing,s=this;e=""+('<thead>\r\n    <tr>\r\n        <th></th>\r\n        <th>Method</th>\r\n        <th>URL</th>\r\n        <th>Status</th>\r\n        <th>Type</th>\r\n        <th>Size</th>\r\n        <th class="timeline">\r\n            <div class="loadMarker" data-dom="'+f((a=(a=(a=(a=(a=(a=c&&c.log,
null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onContentLoad),"function"===typeof a?a.apply(c):a))+'" data-page="'+f((a=(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onLoad),"function"===typeof a?a.apply(c):a))+'"></div>\r\n        </th>\r\n    </tr>\r\n</thead>\r\n<tbody>\r\n');if((d=h.each.call(c,(a=c&&c.log,
null==a||!1===a?a:a.entries),{hash:{},inverse:s.noop,fn:s.program(1,function(a,c){var d,b,e;d=""+('\r\n    <tr data-id="'+f((b=(b=c,null==b||!1===b?b:b.index),"function"===typeof b?b.apply(a):b))+'" class="'+f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.mimetype),"function"===typeof b?b.apply(a):b))+" "+f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.cache),"function"===typeof b?b.apply(a):b))+" "+f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.source),"function"===typeof b?b.apply(a):b))+'">\r\n        <td>'+
f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.index),"function"===typeof b?b.apply(a):b))+"</td>\r\n        <td>"+f((b=(b=a&&a.request,null==b||!1===b?b:b.method),"function"===typeof b?b.apply(a):b))+'</td>\r\n        <td class="url" title="'+f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.url),"function"===typeof b?b.apply(a):b))+'">');e={hash:{},data:c};d+=f((b=h.trimmer||a&&a.trimmer,b?b.call(a,(b=a&&a.harpy_info,null==b||!1===b?b:b.url),30,!0,e):q.call(a,"trimmer",(b=a&&a.harpy_info,null==b||!1===b?
b:b.url),30,!0,e)))+'</td>\r\n        <td title="'+f((b=(b=a&&a.response,null==b||!1===b?b:b.status),"function"===typeof b?b.apply(a):b))+" "+f((b=(b=a&&a.response,null==b||!1===b?b:b.statusText),"function"===typeof b?b.apply(a):b))+'">'+f((b=(b=a&&a.response,null==b||!1===b?b:b.status),"function"===typeof b?b.apply(a):b))+'</td>\r\n        <td title="'+f((b=(b=(b=a&&a.response,null==b||!1===b?b:b.content),null==b||!1===b?b:b.mimeType),"function"===typeof b?b.apply(a):b))+'">'+f((b=(b=a&&a.harpy_info,
null==b||!1===b?b:b.mimetype),"function"===typeof b?b.apply(a):b))+"</td>\r\n        <td>";e={hash:{},data:c};d+=f((b=h.format||a&&a.format,b?b.call(a,(b=a&&a.harpy_info,null==b||!1===b?b:b.size),"size",e):q.call(a,"format",(b=a&&a.harpy_info,null==b||!1===b?b:b.size),"size",e)))+'</td>\r\n        <td title="Blocked: '+f((b=(b=a&&a.timings,null==b||!1===b?b:b.blocked),"function"===typeof b?b.apply(a):b))+" ms, DNS: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.dns),"function"===typeof b?b.apply(a):b))+
" ms, Connect: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.connect),"function"===typeof b?b.apply(a):b))+" ms, Send: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.send),"function"===typeof b?b.apply(a):b))+" ms, Wait: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.wait),"function"===typeof b?b.apply(a):b))+" ms, Receive: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.receive),"function"===typeof b?b.apply(a):b))+' ms">';if((b=s.invokePartial(n.timeline,"timeline",a,h,n,c))||0===b)d+=b;return d+"</td>\r\n    </tr>\r\n"},
k),data:k}))||0===d)e+=d;e+='\r\n</tbody>\r\n<tfoot>\r\n    <tr class="total">\r\n        <td>'+f((a=(a=(a=c&&c.log,null==a||!1===a?a:a.entries),null==a||!1===a?a:a.length),"function"===typeof a?a.apply(c):a))+'</td>\r\n        <td colspan="4"></td>\r\n        <td>';d={hash:{},data:k};e+=f((a=h.format||c&&c.format,a?a.call(c,(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.download),"size",d):q.call(c,
"format",(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.download),"size",d)))+"</td>\r\n        <td>\r\n            (";d={hash:{},data:k};e+=f((a=h.format||c&&c.format,a?a.call(c,(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.cache),"size",d):q.call(c,"format",(a=(a=(a=(a=(a=c&&c.log,null==
a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.cache),"size",d)))+' from cache)\r\n            <span title="DOM: ';d={hash:{},data:k};e+=f((a=h.format||c&&c.format,a?a.call(c,(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onContentLoad),"time",d):q.call(c,"format",(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==
a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onContentLoad),"time",d)))+", Page: ";d={hash:{},data:k};e+=f((a=h.format||c&&c.format,a?a.call(c,(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onLoad),"time",d):q.call(c,"format",(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===
a?a:a.time),null==a||!1===a?a:a.onLoad),"time",d)))+'">';d={hash:{},data:k};return e+=f((a=h.format||c&&c.format,a?a.call(c,(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.total),"time",d):q.call(c,"format",(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.total),"time",d)))+"</span>\r\n        </td>\r\n    </tr>\r\n</tfoot>"});
this.Harpy.Templates.info=Handlebars.template(function(e,c,h,n,k){function a(a,c){var d,e;d="\r\n            <tr>\r\n                <td>";(e=h.name)?e=e.call(a,{hash:{},data:c}):(e=a&&a.name,e=typeof e===f?e.call(a,{hash:{},data:c}):e);d+=q(e)+"</td>\r\n                <td>";(e=h.value)?e=e.call(a,{hash:{},data:c}):(e=a&&a.value,e=typeof e===f?e.call(a,{hash:{},data:c}):e);return d+=q(e)+"</td>\r\n            </tr>\r\n        "}this.compilerInfo=[4,">= 1.0.0"];h=this.merge(h,e.helpers);k=k||{};var d,
f="function",q=this.escapeExpression;e=""+('<td></td>\r\n<td class="info" colspan="6">\r\n    <a href="'+q((d=(d=(d=c&&c.entry,null==d||!1===d?d:d.request),null==d||!1===d?d:d.url),typeof d===f?d.apply(c):d))+'" target="_blank">\r\n        <strong>'+q((d=(d=c&&c.request,null==d||!1===d?d:d.url),typeof d===f?d.apply(c):d))+"</strong>\r\n    </a>\r\n    <br/>\r\n    "+q((d=(d=(d=c&&c.response,null==d||!1===d?d:d.content),null==d||!1===d?d:d.mimeType),typeof d===f?d.apply(c):d))+'\r\n    <hr/>\r\n    <strong>Timings</strong>\r\n    <dl>\r\n        <dt>Blocked</dt>\r\n        <dd class="blocked">'+
q((d=(d=c&&c.timings,null==d||!1===d?d:d.blocked),typeof d===f?d.apply(c):d))+' ms</dd>\r\n        <dt>DNS</dt>\r\n        <dd class="dns">'+q((d=(d=c&&c.timings,null==d||!1===d?d:d.dns),typeof d===f?d.apply(c):d))+' ms</dd>\r\n        <dt>Connect</dt>\r\n        <dd class="connect">'+q((d=(d=c&&c.timings,null==d||!1===d?d:d.connect),typeof d===f?d.apply(c):d))+' ms</dd>\r\n        <dt>Send</dt>\r\n        <dd class="send">'+q((d=(d=c&&c.timings,null==d||!1===d?d:d.send),typeof d===f?d.apply(c):d))+
' ms</dd>\r\n        <dt>Wait</dt>\r\n        <dd class="wait">'+q((d=(d=c&&c.timings,null==d||!1===d?d:d.wait),typeof d===f?d.apply(c):d))+' ms</dd>\r\n        <dt>Receive</dt>\r\n        <dd class="receive">'+q((d=(d=c&&c.timings,null==d||!1===d?d:d.receive),typeof d===f?d.apply(c):d))+" ms</dd>\r\n    </dl>\r\n    <hr/>\r\n    <strong>Request headers</strong>\r\n    <table>\r\n        ");if((n=h.each.call(c,(d=c&&c.request,null==d||!1===d?d:d.headers),{hash:{},inverse:this.noop,fn:this.program(1,
a,k),data:k}))||0===n)e+=n;e+="\r\n    </table>\r\n    <hr/>\r\n    <strong>Response headers</strong>\r\n    <table>\r\n        ";if((n=h.each.call(c,(d=c&&c.response,null==d||!1===d?d:d.headers),{hash:{},inverse:this.noop,fn:this.program(1,a,k),data:k}))||0===n)e+=n;return e+"\r\n    </table>\r\n    <hr/>\r\n</td>"});
this.Harpy.Templates.timeline=Handlebars.template(function(e,c,h,n,k){this.compilerInfo=[4,">= 1.0.0"];this.merge(h,e.helpers);var a;e=this.escapeExpression;return c=""+('<div class="blocked" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.blocked),"function"===typeof a?a.apply(c):a))+'" data-start="'+e((a=(a=c&&c.harpy_info,null==a||!1===a?a:a.startTime),"function"===typeof a?a.apply(c):a))+'"></div>\r\n<div class="dns" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.dns),"function"===
typeof a?a.apply(c):a))+'"></div>\r\n<div class="connect" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.connect),"function"===typeof a?a.apply(c):a))+'"></div>\r\n<div class="send" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.send),"function"===typeof a?a.apply(c):a))+'"></div>\r\n<div class="wait" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.wait),"function"===typeof a?a.apply(c):a))+'"></div>\r\n<div class="receive" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.receive),
"function"===typeof a?a.apply(c):a))+'"></div>')});
