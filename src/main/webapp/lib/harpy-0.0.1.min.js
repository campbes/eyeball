var Harpy=function(){function e(a){return-1!==a.indexOf("image")?"image":-1!==a.indexOf("html")?"html":-1!==a.indexOf("javascript")?"js":-1!==a.indexOf("css")?"css":-1!==a.indexOf("text")?"text":"other"}function d(a,c){switch(c){case "size":return 1024<a?(a=Math.round(a/102.4),a/10+" KB"):a+" B";case "time":return 1E3<a?(a=Math.round(a/10),a/100+" s"):a+" ms"}return a}function k(a,c,d){var f=a.length>c?"...":"";return d?f+(a.length>c?a.substr(a.length-c):a):a.substr(0,c)+f}function r(){return{time:{blocked:0,
    dns:0,connect:0,send:0,wait:0,receive:0},type:{image:0,html:0,js:0,css:0,text:0,other:0},uncached:{image:0,html:0,js:0,css:0,text:0,other:0},size:{cache:0,download:0}}}function l(a,d,p){var e,m,b,q,k,h,l,g;for(e in d)if(d.hasOwnProperty(e)){m=d[e];q=[["",""]];p&&(b=p[e],k=[["",""]]);for(h in m)m.hasOwnProperty(h)&&(q[q.length]=[h,0>m[h]?0:m[h]],b&&b.hasOwnProperty(h)&&(k[k.length]=[h,0>b[h]?0:b[h]]));for(l in c)c.hasOwnProperty(l)&&(f[e][l]=c[l]);m=document.createElement("DIV");m.className="harpyChart";
    document.getElementById(a).appendChild(m);q=google.visualization.arrayToDataTable(q);g=new google.visualization.PieChart(m);p&&(m=google.visualization.arrayToDataTable(k),q=g.computeDiff(m,q));g.draw(q,f[e])}}function a(a,c){var d=document.createElement("DIV");d.className="harpyChart";d.style.width="50%";document.getElementById(a).appendChild(d);var e=google.visualization.arrayToDataTable(c);(new google.visualization.BarChart(d)).draw(e,{colors:["#d9534f","#5cb85c"],legend:"none"})}var c={pieSliceTextStyle:{color:"#000"},
    chartArea:{top:30,left:10,bottom:30,right:10,width:300}},f={time:{colors:"#d9534f #F63 #F96 #9C9 #FC6 #5cb85c".split(" "),title:"Time"},type:{colors:["#CCC","#FFB","#FBF","#BBF","#FBB"],title:"Content"},uncached:{colors:["#CCC","#FFB","#FBF","#BBF","#FBB"],title:"Uncached content"},size:{colors:["#5cb85c","#d9534f"],title:"Cache profile"}};return{Viewer:function(a){function c(){function a(b,c){return Math.floor(Number(b.getAttribute(c))*d)}var d=$("#"+b+" th.timeline").width()/q.total,p=$("#"+b+" table.harpy div"),
    e=$("#"+b+" table.harpy div.loadMarker"),f=$("#"+b+" table.harpy>tbody").height()+"px";p.each(function(){this.hasAttribute("data-start")&&(this.style.marginLeft=a(this,"data-start")+"px");this.hasAttribute("data-time")&&(this.style.width=a(this,"data-time")+"px")});e.each(function(){var b=0,c=0;this.hasAttribute("data-dom")&&(b=a(this,"data-dom"));this.hasAttribute("data-page")&&(c=a(this,"data-page")-b);this.style.marginLeft=b+"px";this.style.width=c+"px";this.style.height=f})}function p(){l(b,h)}
    var f=this,m={},b=null;a=JSON.parse(a);var q=a.log.pages[0].pageTimings;q.total=q.onLoad;var t=new Date(a.log.pages[0].startedDateTime),h=r(),u,g,v,s,y,w,x=a.log.entries[0].request.url.split("://");x[1]&&(x=x[1],x=x.split("/")[0]);for(u=0;u<a.log.entries.length;u++){g=a.log.entries[u];g.harpy_info={};m[u]=g;v=g.request.url;g.harpy_info.source=-1<v.indexOf(x)?"internal":"external";0<u&&(v=v.replace(a.log.entries[0].request.url,""));s=e(g.response.content.mimeType);y=(new Date(g.startedDateTime)).getTime()+
        g.time;y>t.getTime()+q.total&&(q.total=y-t);for(w in g.timings)g.timings.hasOwnProperty(w)&&0<g.timings[w]&&(h.time[w]+=g.timings[w]);h.type[s]+=g.response.bodySize;h.uncached[s]+=g.response.bodySize;h.size.download+=g.response.bodySize;g.harpy_info.index=u+1;g.harpy_info.url=v;g.harpy_info.mimetype=s;g.harpy_info.cache="(cache)"===g.response.status?" cache":"";g.cache.hasOwnProperty("afterRequest")?(h.size.cache+=g.response.content.size,h.type[s]+=g.response.content.size,g.harpy_info.size=g.response.content.size):
        g.harpy_info.size=g.response.bodySize;g.harpy_info.startTime=new Date(g.startedDateTime)-t}t={};t.time=q;t.time.onContentLoad=q.onContentLoad||q.onLoad;t.size=h.size;a.log.pages[0].harpy_info=t;this.resize=c;this.showInfo=function(a){var b=a.getAttribute("data-id");g=m[b];g.info?g.info.style.display="none"===g.info.style.display?"table-row":"none":(b=document.createElement("TR"),b.innerHTML=Harpy.Templates.info(g),$(a).after(b),g.info=b);c()};this.draw=function(c){this.el=b=c;google.visualization?
        p():(google.load("visualization","1",{packages:["corechart"]}),google.setOnLoadCallback(p));c={};c["#"+b+" table.harpy>tbody>tr"]={click:function(a,b){f.showInfo(b)}};Exos.enable([c,{window:{resize:function(){f.resize()}}}]);Handlebars.registerHelper("trimmer",k);Handlebars.registerHelper("format",d);Handlebars.registerPartial("timeline",Harpy.Templates.timeline);c=document.createElement("TABLE");c.innerHTML=Harpy.Templates.data(a);c.className="harpy";document.getElementById(b).appendChild(c);setTimeout(this.resize,
        1);$.tablesorter&&$(c).tablesorter({sortList:[[0,0]]})}},Comparator:function(c,d){function p(a){var b,c,d,p,f,m,g=a.log.pages[0].pageTimings;g.total=g.onLoad;var k=new Date(a.log.pages[0].startedDateTime),h=r();for(c=0;c<a.log.entries.length;c++){b=a.log.entries[c];d=b.request.url;p=e(b.response.content.mimeType);f=(new Date(b.startedDateTime)).getTime()+b.time;f>k.getTime()+g.total&&(g.total=f-k);for(m in b.timings)b.timings.hasOwnProperty(m)&&0<b.timings[m]&&(h.time[m]+=b.timings[m]);h.type[p]+=
    b.response.bodySize;h.uncached[p]+=b.response.bodySize;h.size.download+=b.response.bodySize;0<c&&d.replace(a.log.entries[0].request.url,"");b.cache.hasOwnProperty("afterRequest")&&(h.size.cache+=b.response.content.size,h.type[p]+=b.response.content.size)}return h}function f(a){a=a.log.entries;var b=0,c;for(c=a.length-1;0<=c;c--)"(cache)"!==a[c].response.status&&(b+=1);return b}function m(){l(b,k,t);a(b,w);a(b,y)}c=JSON.parse(c);d=JSON.parse(d);var b,k=p(c),t=p(d),h=f(c),u=f(d),g=c.log.pages[0].pageTimings,
    v=d.log.pages[0].pageTimings,s=["Metric","Uncached","Primed cache"],y=[s,["Dom load",v.onContentLoad/1E3,g.onContentLoad/1E3],["Load",v.onLoad/1E3,g.onLoad/1E3],["Total",v.total/1E3,g.total/1E3]],w=[s,["Requests",u,h]];this.draw=function(a){this.el=b=a;google.visualization?m():(google.load("visualization","1",{packages:["corechart"]}),google.setOnLoadCallback(m))}}}}();this.Harpy=this.Harpy||{};this.Harpy.Templates=this.Harpy.Templates||{};
this.Harpy.Templates.data=Handlebars.template(function(e,d,k,r,l){this.compilerInfo=[4,">= 1.0.0"];k=this.merge(k,e.helpers);r=this.merge(r,e.partials);l=l||{};var a,c,f=this.escapeExpression,n=k.helperMissing,z=this;e=""+('<thead>\r\n    <tr>\r\n        <th></th>\r\n        <th>Method</th>\r\n        <th>URL</th>\r\n        <th>Status</th>\r\n        <th>Type</th>\r\n        <th>Size</th>\r\n        <th class="timeline">\r\n            <div class="loadMarker" data-dom="'+f((a=(a=(a=(a=(a=(a=d&&d.log,
    null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onContentLoad),"function"===typeof a?a.apply(d):a))+'" data-page="'+f((a=(a=(a=(a=(a=(a=d&&d.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onLoad),"function"===typeof a?a.apply(d):a))+'"></div>\r\n        </th>\r\n    </tr>\r\n</thead>\r\n<tbody>\r\n');if((c=k.each.call(d,(a=d&&d.log,
    null==a||!1===a?a:a.entries),{hash:{},inverse:z.noop,fn:z.program(1,function(a,c){var d,b,e;d=""+('\r\n    <tr data-id="'+f((b=(b=c,null==b||!1===b?b:b.index),"function"===typeof b?b.apply(a):b))+'" class="'+f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.mimetype),"function"===typeof b?b.apply(a):b))+" "+f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.cache),"function"===typeof b?b.apply(a):b))+" "+f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.source),"function"===typeof b?b.apply(a):b))+'">\r\n        <td>'+
        f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.index),"function"===typeof b?b.apply(a):b))+"</td>\r\n        <td>"+f((b=(b=a&&a.request,null==b||!1===b?b:b.method),"function"===typeof b?b.apply(a):b))+'</td>\r\n        <td class="url" title="'+f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.url),"function"===typeof b?b.apply(a):b))+'">');e={hash:{},data:c};d+=f((b=k.trimmer||a&&a.trimmer,b?b.call(a,(b=a&&a.harpy_info,null==b||!1===b?b:b.url),30,!0,e):n.call(a,"trimmer",(b=a&&a.harpy_info,null==b||!1===b?
        b:b.url),30,!0,e)))+'</td>\r\n        <td title="'+f((b=(b=a&&a.response,null==b||!1===b?b:b.status),"function"===typeof b?b.apply(a):b))+" "+f((b=(b=a&&a.response,null==b||!1===b?b:b.statusText),"function"===typeof b?b.apply(a):b))+'">'+f((b=(b=a&&a.response,null==b||!1===b?b:b.status),"function"===typeof b?b.apply(a):b))+'</td>\r\n        <td title="'+f((b=(b=(b=a&&a.response,null==b||!1===b?b:b.content),null==b||!1===b?b:b.mimeType),"function"===typeof b?b.apply(a):b))+'">'+f((b=(b=a&&a.harpy_info,
        null==b||!1===b?b:b.mimetype),"function"===typeof b?b.apply(a):b))+"</td>\r\n        <td>";e={hash:{},data:c};d+=f((b=k.format||a&&a.format,b?b.call(a,(b=a&&a.harpy_info,null==b||!1===b?b:b.size),"size",e):n.call(a,"format",(b=a&&a.harpy_info,null==b||!1===b?b:b.size),"size",e)))+'</td>\r\n        <td title="Blocked: '+f((b=(b=a&&a.timings,null==b||!1===b?b:b.blocked),"function"===typeof b?b.apply(a):b))+" ms, DNS: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.dns),"function"===typeof b?b.apply(a):b))+
        " ms, Connect: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.connect),"function"===typeof b?b.apply(a):b))+" ms, Send: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.send),"function"===typeof b?b.apply(a):b))+" ms, Wait: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.wait),"function"===typeof b?b.apply(a):b))+" ms, Receive: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.receive),"function"===typeof b?b.apply(a):b))+' ms">';if((b=z.invokePartial(r.timeline,"timeline",a,k,r,c))||0===b)d+=b;return d+"</td>\r\n    </tr>\r\n"},
    l),data:l}))||0===c)e+=c;e+='\r\n</tbody>\r\n<tfoot>\r\n    <tr class="total">\r\n        <td>'+f((a=(a=(a=d&&d.log,null==a||!1===a?a:a.entries),null==a||!1===a?a:a.length),"function"===typeof a?a.apply(d):a))+'</td>\r\n        <td colspan="4"></td>\r\n        <td>';c={hash:{},data:l};e+=f((a=k.format||d&&d.format,a?a.call(d,(a=(a=(a=(a=(a=d&&d.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.download),"size",c):n.call(d,
    "format",(a=(a=(a=(a=(a=d&&d.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.download),"size",c)))+"</td>\r\n        <td>\r\n            (";c={hash:{},data:l};e+=f((a=k.format||d&&d.format,a?a.call(d,(a=(a=(a=(a=(a=d&&d.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.cache),"size",c):n.call(d,"format",(a=(a=(a=(a=(a=d&&d.log,null==
    a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.cache),"size",c)))+' from cache)\r\n            <span title="DOM: ';c={hash:{},data:l};e+=f((a=k.format||d&&d.format,a?a.call(d,(a=(a=(a=(a=(a=d&&d.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onContentLoad),"time",c):n.call(d,"format",(a=(a=(a=(a=(a=d&&d.log,null==a||!1===a?a:a.pages),null==
    a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onContentLoad),"time",c)))+", Page: ";c={hash:{},data:l};e+=f((a=k.format||d&&d.format,a?a.call(d,(a=(a=(a=(a=(a=d&&d.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onLoad),"time",c):n.call(d,"format",(a=(a=(a=(a=(a=d&&d.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===
    a?a:a.time),null==a||!1===a?a:a.onLoad),"time",c)))+'">';c={hash:{},data:l};return e+=f((a=k.format||d&&d.format,a?a.call(d,(a=(a=(a=(a=(a=d&&d.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.total),"time",c):n.call(d,"format",(a=(a=(a=(a=(a=d&&d.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.total),"time",c)))+"</span>\r\n        </td>\r\n    </tr>\r\n</tfoot>"});
this.Harpy.Templates.info=Handlebars.template(function(e,d,k,r,l){function a(a,c){var d,e;d="\r\n            <tr>\r\n                <td>";(e=k.name)?e=e.call(a,{hash:{},data:c}):(e=a&&a.name,e=typeof e===f?e.call(a,{hash:{},data:c}):e);d+=n(e)+"</td>\r\n                <td>";(e=k.value)?e=e.call(a,{hash:{},data:c}):(e=a&&a.value,e=typeof e===f?e.call(a,{hash:{},data:c}):e);return d+=n(e)+"</td>\r\n            </tr>\r\n        "}this.compilerInfo=[4,">= 1.0.0"];k=this.merge(k,e.helpers);l=l||{};var c,
    f="function",n=this.escapeExpression;e=""+('<td></td>\r\n<td class="info" colspan="6">\r\n    <a href="'+n((c=(c=(c=d&&d.entry,null==c||!1===c?c:c.request),null==c||!1===c?c:c.url),typeof c===f?c.apply(d):c))+'" target="_blank">\r\n        <strong>'+n((c=(c=d&&d.request,null==c||!1===c?c:c.url),typeof c===f?c.apply(d):c))+"</strong>\r\n    </a>\r\n    <br/>\r\n    "+n((c=(c=(c=d&&d.response,null==c||!1===c?c:c.content),null==c||!1===c?c:c.mimeType),typeof c===f?c.apply(d):c))+'\r\n    <hr/>\r\n    <strong>Timings</strong>\r\n    <dl>\r\n        <dt>Blocked</dt>\r\n        <dd class="blocked">'+
    n((c=(c=d&&d.timings,null==c||!1===c?c:c.blocked),typeof c===f?c.apply(d):c))+' ms</dd>\r\n        <dt>DNS</dt>\r\n        <dd class="dns">'+n((c=(c=d&&d.timings,null==c||!1===c?c:c.dns),typeof c===f?c.apply(d):c))+' ms</dd>\r\n        <dt>Connect</dt>\r\n        <dd class="connect">'+n((c=(c=d&&d.timings,null==c||!1===c?c:c.connect),typeof c===f?c.apply(d):c))+' ms</dd>\r\n        <dt>Send</dt>\r\n        <dd class="send">'+n((c=(c=d&&d.timings,null==c||!1===c?c:c.send),typeof c===f?c.apply(d):c))+
    ' ms</dd>\r\n        <dt>Wait</dt>\r\n        <dd class="wait">'+n((c=(c=d&&d.timings,null==c||!1===c?c:c.wait),typeof c===f?c.apply(d):c))+' ms</dd>\r\n        <dt>Receive</dt>\r\n        <dd class="receive">'+n((c=(c=d&&d.timings,null==c||!1===c?c:c.receive),typeof c===f?c.apply(d):c))+" ms</dd>\r\n    </dl>\r\n    <hr/>\r\n    <strong>Request headers</strong>\r\n    <table>\r\n        ");if((r=k.each.call(d,(c=d&&d.request,null==c||!1===c?c:c.headers),{hash:{},inverse:this.noop,fn:this.program(1,
    a,l),data:l}))||0===r)e+=r;e+="\r\n    </table>\r\n    <hr/>\r\n    <strong>Response headers</strong>\r\n    <table>\r\n        ";if((r=k.each.call(d,(c=d&&d.response,null==c||!1===c?c:c.headers),{hash:{},inverse:this.noop,fn:this.program(1,a,l),data:l}))||0===r)e+=r;return e+"\r\n    </table>\r\n    <hr/>\r\n</td>"});
this.Harpy.Templates.timeline=Handlebars.template(function(e,d,k,r,l){this.compilerInfo=[4,">= 1.0.0"];this.merge(k,e.helpers);var a;e=this.escapeExpression;return d=""+('<div class="blocked" data-time="'+e((a=(a=d&&d.timings,null==a||!1===a?a:a.blocked),"function"===typeof a?a.apply(d):a))+'" data-start="'+e((a=(a=d&&d.harpy_info,null==a||!1===a?a:a.startTime),"function"===typeof a?a.apply(d):a))+'"></div>\r\n<div class="dns" data-time="'+e((a=(a=d&&d.timings,null==a||!1===a?a:a.dns),"function"===
    typeof a?a.apply(d):a))+'"></div>\r\n<div class="connect" data-time="'+e((a=(a=d&&d.timings,null==a||!1===a?a:a.connect),"function"===typeof a?a.apply(d):a))+'"></div>\r\n<div class="send" data-time="'+e((a=(a=d&&d.timings,null==a||!1===a?a:a.send),"function"===typeof a?a.apply(d):a))+'"></div>\r\n<div class="wait" data-time="'+e((a=(a=d&&d.timings,null==a||!1===a?a:a.wait),"function"===typeof a?a.apply(d):a))+'"></div>\r\n<div class="receive" data-time="'+e((a=(a=d&&d.timings,null==a||!1===a?a:a.receive),
    "function"===typeof a?a.apply(d):a))+'"></div>')});
