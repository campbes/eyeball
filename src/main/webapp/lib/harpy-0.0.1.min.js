var Harpy=function(){function e(a){return-1!==a.indexOf("image")?"image":-1!==a.indexOf("html")?"html":-1!==a.indexOf("javascript")?"js":-1!==a.indexOf("css")?"css":-1!==a.indexOf("text")?"text":"other"}function c(a,c){switch(c){case "size":return 1024<a?(a=Math.round(a/102.4),a/10+" KB"):a+" B";case "time":return 1E3<a?(a=Math.round(a/10),a/100+" s"):a+" ms"}return a}function k(a,c,n){var d=a.length>c?"...":"";return n?d+(a.length>c?a.substr(a.length-c):a):a.substr(0,c)+d}function q(){return{time:{blocked:0,
    dns:0,connect:0,send:0,wait:0,receive:0},type:{image:0,html:0,js:0,css:0,text:0,other:0},uncached:{image:0,html:0,js:0,css:0,text:0,other:0},size:{cache:0,download:0}}}function l(a,c,n){var e,m,b,p,k,h,l,f;for(e in c)if(c.hasOwnProperty(e)){m=c[e];p=[["",""]];n&&(b=n[e],k=[["",""]]);for(h in m)m.hasOwnProperty(h)&&(p[p.length]=[h,0>m[h]?0:m[h]],b&&b.hasOwnProperty(h)&&(k[k.length]=[h,0>b[h]?0:b[h]]));for(l in d)d.hasOwnProperty(l)&&(g[e][l]=d[l]);m=document.createElement("DIV");m.className="harpyChart";
    document.getElementById(a).appendChild(m);p=google.visualization.arrayToDataTable(p);f=new google.visualization.PieChart(m);n&&(m=google.visualization.arrayToDataTable(k),p=f.computeDiff(m,p));f.draw(p,g[e])}}function a(a,c){var d=document.createElement("DIV");d.className="harpyChart";d.style.width="50%";document.getElementById(a).appendChild(d);var e=google.visualization.arrayToDataTable(c);(new google.visualization.BarChart(d)).draw(e,{colors:["#d9534f","#5cb85c"],legend:"none"})}var d={pieSliceTextStyle:{color:"#000"},
    chartArea:{top:30,left:10,bottom:30,right:10,width:300}},g={time:{colors:"#d9534f #F63 #F96 #9C9 #FC6 #5cb85c".split(" "),title:"Time"},type:{colors:["#CCC","#FFB","#FBF","#BBF","#FBB"],title:"Content"},uncached:{colors:["#CCC","#FFB","#FBF","#BBF","#FBB"],title:"Uncached content"},size:{colors:["#5cb85c","#d9534f"],title:"Cache profile"}};return{Viewer:function(a){function d(){function a(b,d){return Math.floor(Number(b.getAttribute(d))*c)}var c=$("#"+b+" th.timeline").width()/p.total,n=$("#"+b+" table.harpy div"),
    e=$("#"+b+" table.harpy div.loadMarker"),m=$("#"+b+" table.harpy>tbody").height()+"px";n.each(function(){this.hasAttribute("data-start")&&(this.style.marginLeft=a(this,"data-start")+"px");this.hasAttribute("data-time")&&(this.style.width=a(this,"data-time")+"px")});e.each(function(){var b=0,c=0;this.hasAttribute("data-dom")&&(b=a(this,"data-dom"));this.hasAttribute("data-page")&&(c=a(this,"data-page")-b);this.style.marginLeft=b+"px";this.style.width=c+"px";this.style.height=m})}function n(){l(b,h)}
    var g=this,m={},b=null;a=JSON.parse(a);var p=a.log.pages[0].pageTimings;p.total=p.onLoad;var t=new Date(a.log.pages[0].startedDateTime),h=q(),u,f,v,s,x,w;for(u=0;u<a.log.entries.length;u++){f=a.log.entries[u];f.harpy_info={};m[u]=f;v=f.request.url;0<u&&(v=v.replace(a.log.entries[0].request.url,""));s=e(f.response.content.mimeType);x=(new Date(f.startedDateTime)).getTime()+f.time;x>t.getTime()+p.total&&(p.total=x-t);for(w in f.timings)f.timings.hasOwnProperty(w)&&0<f.timings[w]&&(h.time[w]+=f.timings[w]);
        h.type[s]+=f.response.bodySize;h.uncached[s]+=f.response.bodySize;h.size.download+=f.response.bodySize;f.harpy_info.index=u+1;f.harpy_info.url=v;f.harpy_info.mimetype=s;f.harpy_info.cache="(cache)"===f.response.status?" cache":"";f.cache.hasOwnProperty("afterRequest")?(h.size.cache+=f.response.content.size,h.type[s]+=f.response.content.size,f.harpy_info.size=f.response.content.size):f.harpy_info.size=f.response.bodySize;f.harpy_info.startTime=new Date(f.startedDateTime)-t}t={};t.time=p;t.time.onContentLoad=
        p.onContentLoad||p.onLoad;t.size=h.size;a.log.pages[0].harpy_info=t;this.resize=d;this.showInfo=function(a){var b=a.getAttribute("data-id");f=m[b];f.info?f.info.style.display="none"===f.info.style.display?"table-row":"none":(b=document.createElement("TR"),b.innerHTML=Handlebars.templates.info(f),$(a).after(b),f.info=b);d()};this.draw=function(d){this.el=b=d;google.visualization?n():(google.load("visualization","1",{packages:["corechart"]}),google.setOnLoadCallback(n));d={};d["#"+b+" table.harpy>tbody>tr"]=
    {click:function(a,b){g.showInfo(b)}};Exos.enable([d,{window:{resize:function(){g.resize()}}}]);Handlebars.registerHelper("trimmer",k);Handlebars.registerHelper("format",c);Handlebars.registerPartial("timeline",Harpy.Templates.timeline);d=document.createElement("TABLE");d.innerHTML=Harpy.Templates.data(a);d.className="harpy";document.getElementById(b).appendChild(d);setTimeout(this.resize,1);$.tablesorter&&$("#"+b+">table").tablesorter({sortList:[[0,0]]})}},Comparator:function(c,d){function n(a){var b,
    c,d,n,m,f,g=a.log.pages[0].pageTimings;g.total=g.onLoad;var k=new Date(a.log.pages[0].startedDateTime),h=q();for(c=0;c<a.log.entries.length;c++){b=a.log.entries[c];d=b.request.url;n=e(b.response.content.mimeType);m=(new Date(b.startedDateTime)).getTime()+b.time;m>k.getTime()+g.total&&(g.total=m-k);for(f in b.timings)b.timings.hasOwnProperty(f)&&0<b.timings[f]&&(h.time[f]+=b.timings[f]);h.type[n]+=b.response.bodySize;h.uncached[n]+=b.response.bodySize;h.size.download+=b.response.bodySize;0<c&&d.replace(a.log.entries[0].request.url,
    "");b.cache.hasOwnProperty("afterRequest")&&(h.size.cache+=b.response.content.size,h.type[n]+=b.response.content.size)}return h}function g(a){a=a.log.entries;var b=0,c;for(c=a.length-1;0<=c;c--)"(cache)"!==a[c].response.status&&(b+=1);return b}function m(){l(b,k,t);a(b,w);a(b,x)}c=JSON.parse(c);d=JSON.parse(d);var b,k=n(c),t=n(d),h=g(c),u=g(d),f=c.log.pages[0].pageTimings,v=d.log.pages[0].pageTimings,s=["Metric","Uncached","Primed cache"],x=[s,["Dom load",v.onContentLoad/1E3,f.onContentLoad/1E3],
    ["Load",v.onLoad/1E3,f.onLoad/1E3],["Total",v.total/1E3,f.total/1E3]],w=[s,["Requests",u,h]];this.draw=function(a){this.el=b=a;google.visualization?m():(google.load("visualization","1",{packages:["corechart"]}),google.setOnLoadCallback(m))}}}}();this.Harpy=this.Harpy||{};this.Harpy.Templates=this.Harpy.Templates||{};
this.Harpy.Templates.data=Handlebars.template(function(e,c,k,q,l){this.compilerInfo=[4,">= 1.0.0"];k=this.merge(k,e.helpers);q=this.merge(q,e.partials);l=l||{};var a,d,g=this.escapeExpression,r=k.helperMissing,y=this;e=""+('<thead>\r\n    <tr>\r\n        <th>Req.</th>\r\n        <th>Meth.</th>\r\n        <th>URL</th>\r\n        <th>Status</th>\r\n        <th>Type</th>\r\n        <th>Size</th>\r\n        <th class="timeline">\r\n            <div class="loadMarker" data-dom="'+g((a=(a=(a=(a=(a=(a=c&&
    c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onContentLoad),"function"===typeof a?a.apply(c):a))+'" data-page="'+g((a=(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onLoad),"function"===typeof a?a.apply(c):a))+'"></div>\r\n        </th>\r\n    </tr>\r\n</thead>\r\n<tbody>\r\n');if((d=k.each.call(c,(a=c&&
    c.log,null==a||!1===a?a:a.entries),{hash:{},inverse:y.noop,fn:y.program(1,function(a,c){var d,b,e;d=""+('\r\n    <tr data-id="'+g((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.index),"function"===typeof b?b.apply(a):b))+'" class="'+g((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.mimetype),"function"===typeof b?b.apply(a):b))+" "+g((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.cache),"function"===typeof b?b.apply(a):b))+'">\r\n        <td>'+g((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.index),"function"===typeof b?
    b.apply(a):b))+"</td>\r\n        <td>"+g((b=(b=a&&a.request,null==b||!1===b?b:b.method),"function"===typeof b?b.apply(a):b))+'</td>\r\n        <td class="url" title="'+g((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.url),"function"===typeof b?b.apply(a):b))+'">');e={hash:{},data:c};d+=g((b=k.trimmer||a&&a.trimmer,b?b.call(a,(b=a&&a.harpy_info,null==b||!1===b?b:b.url),30,!0,e):r.call(a,"trimmer",(b=a&&a.harpy_info,null==b||!1===b?b:b.url),30,!0,e)))+'</td>\r\n        <td title="'+g((b=(b=a&&a.response,
    null==b||!1===b?b:b.status),"function"===typeof b?b.apply(a):b))+" "+g((b=(b=a&&a.response,null==b||!1===b?b:b.statusText),"function"===typeof b?b.apply(a):b))+'">'+g((b=(b=a&&a.response,null==b||!1===b?b:b.status),"function"===typeof b?b.apply(a):b))+'</td>\r\n        <td title="'+g((b=(b=(b=a&&a.response,null==b||!1===b?b:b.content),null==b||!1===b?b:b.mimeType),"function"===typeof b?b.apply(a):b))+'">'+g((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.mimetype),"function"===typeof b?b.apply(a):b))+"</td>\r\n        <td>";
    e={hash:{},data:c};d+=g((b=k.format||a&&a.format,b?b.call(a,(b=a&&a.harpy_info,null==b||!1===b?b:b.size),"size",e):r.call(a,"format",(b=a&&a.harpy_info,null==b||!1===b?b:b.size),"size",e)))+"</td>\r\n        <td>";if((b=y.invokePartial(q.timeline,"timeline",a,k,q,c))||0===b)d+=b;return d+"</td>\r\n    </tr>\r\n"},l),data:l}))||0===d)e+=d;e+='\r\n</tbody>\r\n<tfoot>\r\n    <tr class="total">\r\n        <td>'+g((a=(a=(a=c&&c.log,null==a||!1===a?a:a.entries),null==a||!1===a?a:a.length),"function"===
    typeof a?a.apply(c):a))+'</td>\r\n        <td colspan="4"></td>\r\n        <td>';d={hash:{},data:l};e+=g((a=k.format||c&&c.format,a?a.call(c,(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.download),"size",d):r.call(c,"format",(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.download),"size",
    d)))+"</td>\r\n        <td>\r\n            (";d={hash:{},data:l};e+=g((a=k.format||c&&c.format,a?a.call(c,(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.cache),"size",d):r.call(c,"format",(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.cache),"size",d)))+' from cache)\r\n            <span title="DOM: ';
    d={hash:{},data:l};e+=g((a=k.format||c&&c.format,a?a.call(c,(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onContentLoad),"time",d):r.call(c,"format",(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onContentLoad),"time",d)))+", Page: ";d={hash:{},data:l};e+=g((a=k.format||c&&c.format,a?a.call(c,
        (a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onLoad),"time",d):r.call(c,"format",(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onLoad),"time",d)))+'">';d={hash:{},data:l};return e+=g((a=k.format||c&&c.format,a?a.call(c,(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?
        a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.total),"time",d):r.call(c,"format",(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.total),"time",d)))+"</span>\r\n        </td>\r\n    </tr>\r\n</tfoot>"});
this.Harpy.Templates.info=Handlebars.template(function(e,c,k,q,l){function a(a,c){var d,e;d="\r\n            <tr>\r\n                <td>";(e=k.name)?e=e.call(a,{hash:{},data:c}):(e=a&&a.name,e=typeof e===g?e.call(a,{hash:{},data:c}):e);d+=r(e)+"</td>\r\n                <td>";(e=k.value)?e=e.call(a,{hash:{},data:c}):(e=a&&a.value,e=typeof e===g?e.call(a,{hash:{},data:c}):e);return d+=r(e)+"</td>\r\n            </tr>\r\n        "}this.compilerInfo=[4,">= 1.0.0"];k=this.merge(k,e.helpers);l=l||{};var d,
    g="function",r=this.escapeExpression;e=""+('<td></td>\r\n<td class="info" colspan="6">\r\n    <a href="'+r((d=(d=(d=c&&c.entry,null==d||!1===d?d:d.request),null==d||!1===d?d:d.url),typeof d===g?d.apply(c):d))+'" target="_blank">\r\n        <strong>'+r((d=(d=c&&c.request,null==d||!1===d?d:d.url),typeof d===g?d.apply(c):d))+"</strong>\r\n    </a>\r\n    <br/>\r\n    "+r((d=(d=(d=c&&c.response,null==d||!1===d?d:d.content),null==d||!1===d?d:d.mimeType),typeof d===g?d.apply(c):d))+"\r\n    <hr/>\r\n    <strong>Request headers</strong>\r\n    <table>\r\n        ");
    if((q=k.each.call(c,(d=c&&c.request,null==d||!1===d?d:d.headers),{hash:{},inverse:this.noop,fn:this.program(1,a,l),data:l}))||0===q)e+=q;e+="\r\n    </table>\r\n    <hr/>\r\n    <strong>Response headers</strong>\r\n    <table>\r\n        ";if((q=k.each.call(c,(d=c&&c.response,null==d||!1===d?d:d.headers),{hash:{},inverse:this.noop,fn:this.program(1,a,l),data:l}))||0===q)e+=q;return e+"\r\n    </table>\r\n    <hr/>\r\n</td>"});
this.Harpy.Templates.timeline=Handlebars.template(function(e,c,k,q,l){this.compilerInfo=[4,">= 1.0.0"];this.merge(k,e.helpers);var a;e=this.escapeExpression;return c=""+('<div class="blocked" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.blocked),"function"===typeof a?a.apply(c):a))+'" data-start="'+e((a=(a=c&&c.harpy_info,null==a||!1===a?a:a.startTime),"function"===typeof a?a.apply(c):a))+'"></div>\r\n<div class="dns" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.dns),"function"===
    typeof a?a.apply(c):a))+'"></div>\r\n<div class="connect" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.connect),"function"===typeof a?a.apply(c):a))+'"></div>\r\n<div class="send" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.send),"function"===typeof a?a.apply(c):a))+'"></div>\r\n<div class="wait" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.wait),"function"===typeof a?a.apply(c):a))+'"></div>\r\n<div class="receive" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.receive),
    "function"===typeof a?a.apply(c):a))+'"></div>')});
