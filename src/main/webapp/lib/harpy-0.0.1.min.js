var Harpy=function(){function c(k,c,n){var e,q;e="<"+k;for(q in n)n.hasOwnProperty(q)&&(e+=" ",e+=q,e+='="',e+=n[q],e+='"');e+=">";c&&(e+=c);e=e+"</"+k;return e+=">"}function w(k,m){for(var n="",e="blocked dns connect send wait receive".split(" "),q=e.length,l=0,a,g,l=0;l<q;l++)a=e[l],g={"class":a,"data-time":k.timings[a]},"blocked"===a&&(g["data-start"]=new Date(k.startedDateTime)-m),n+=c("div","",g);return n}function m(c,m){switch(m){case "size":return 1024<c?(c=Math.round(c/102.4),c/10+" KB"):
c+" B";case "time":return 1E3<c?(c=Math.round(c/10),c/100+" s"):c+" ms"}return c}return{Viewer:function(k){function v(){function a(b,c){return Math.round(Number(b.getAttribute(c))*d)}var d=$("#"+l+" th.timeline").width()/g.total,b=$("#"+l+" table.harpy div"),c=$("#"+l+" table.harpy div.loadMarker"),e=$("#"+l+" table.harpy>tbody").height()+"px";b.each(function(){this.hasAttribute("data-start")&&(this.style.marginLeft=a(this,"data-start")+"px");this.hasAttribute("data-time")&&(this.style.width=a(this,
"data-time")+"px")});c.each(function(){var d=0,b=0;this.hasAttribute("data-dom")&&(d=a(this,"data-dom"));this.hasAttribute("data-page")&&(b=a(this,"data-page")-d);this.style.marginLeft=d+"px";this.style.width=b+"px";this.style.height=e})}function n(){var a={pieSliceTextStyle:{color:"#000"},chartArea:{top:30,left:10,bottom:30,right:10,width:300}},d={time:{colors:"#d9534f #F63 #F96 #9C9 #FC6 #5cb85c".split(" "),title:"Time"},type:{colors:["#CCC","#FFB","#FBF","#BBF","#FBB"],title:"Content"},uncached:{colors:["#CCC",
"#FFB","#FBF","#BBF","#FBB"],title:"Uncached content"},size:{colors:["#5cb85c","#d9534f"],title:"Cache profile"}},b,c,e,f,g;for(b in h)if(h.hasOwnProperty(b)){c=h[b];e=[["",""]];for(f in c)c.hasOwnProperty(f)&&(e[e.length]=[f,0>c[f]?0:c[f]]);for(g in a)a.hasOwnProperty(g)&&(d[b][g]=a[g]);c=document.createElement("DIV");c.className="harpyChart";document.getElementById(l).appendChild(c);e=google.visualization.arrayToDataTable(e);c=new google.visualization.PieChart(c);c.draw(e,d[b])}}var e=this,q={},
l=null,a="";k=JSON.parse(k);var g=k.log.pages[0].pageTimings;g.total=g.onLoad;for(var u=new Date(k.log.pages[0].startedDateTime),h={time:{blocked:0,dns:0,connect:0,send:0,wait:0,receive:0},type:{image:0,html:0,js:0,css:0,text:0,other:0},uncached:{image:0,html:0,js:0,css:0,text:0,other:0},size:{cache:0,download:0}},s=["Req.","Meth.","URL","Status","Type","Size",{val:c("div","",{"class":"loadMarker","data-dom":g.onContentLoad||g.onLoad,"data-page":g.onLoad}),attrs:{"class":"timeline"}}],p=s.length,
r,f=0,a=a+"<thead><tr>",f=0;f<p;f++)r=s[f],"string"===typeof r&&(a+=c("th",r)),r.val&&(a+=c("th",r.val,r.attrs));for(var a=a+"</tr></thead>",a=a+"<tbody>",b,t,f=0;f<k.log.entries.length;f++){b=k.log.entries[f];q[f]=b;s=b.request.url;p=-1!==b.response.content.mimeType.indexOf("image")?"image":-1!==b.response.content.mimeType.indexOf("html")?"html":-1!==b.response.content.mimeType.indexOf("javascript")?"js":-1!==b.response.content.mimeType.indexOf("css")?"css":-1!==b.response.content.mimeType.indexOf("text")?
"text":"other";r=(new Date(b.startedDateTime)).getTime()+b.time;r>u.getTime()+g.total&&(g.total=r-u);for(t in b.timings)b.timings.hasOwnProperty(t)&&0<b.timings[t]&&(h.time[t]+=b.timings[t]);h.type[p]+=b.response.bodySize;h.uncached[p]+=b.response.bodySize;h.size.download+=b.response.bodySize;0<f&&(s=s.replace(k.log.entries[0].request.url,""));a+="<tr data-id='"+f+"' class='"+p+("(cache)"===b.response.status?" cache":"")+"'>";a+=c("td",f+1);a+=c("td",b.request.method);a+=c("td",s.substr(0,30)+(30<
s.length?"...":""),{title:s,"class":"url"});a+=c("td",b.response.status,{title:b.response.status+" "+b.response.statusText});a+=c("td",p,{title:b.response.content.mimeType});b.cache.hasOwnProperty("afterRequest")?(a+=c("td",m(b.response.content.size,"size")),h.size.cache+=b.response.content.size,h.type[p]+=b.response.content.size):a+=c("td",m(b.response.bodySize,"size"));a+=c("td",w(b,u),{title:m(b.time,"time")});a+="</tr>"}a+="</tbody>";a+="<tfoot><tr class='total'>";a+=c("td",k.log.entries.length);
a+=c("td","",{colspan:4});a+=c("td",m(h.size.download+h.size.cache,"size"));a+="<td>";a+=m(h.size.cache,"size")+" from cache)";a+=c("span",m(g.total,"time"),{title:"DOM: "+m(g.onContentLoad||g.onLoad,"time")+", Page: "+m(g.onLoad,"time")});a+="</td>";a+="</tr></tfoot>";this.resize=v;this.showInfo=function(a){var d=a.getAttribute("data-id");b=q[d];if(b.info)b.info.style.display="none"===b.info.style.display?"table-row":"none";else{d=c("td");d=d+"<td class='info' colspan='6'>"+("<a href='"+b.request.url+
"' target='_blank'><strong>"+b.request.url+"</strong></a>");d+="<br/>";d+=b.response.content.mimeType;d+="<hr/>";d+=c("strong","Request headers");d+="<table>";for(f=0;f<b.request.headers.length;f++)d+="<tr>",d+=c("td",b.request.headers[f].name),d+=c("td",b.request.headers[f].value),d+="</tr>";d+="</table>";d+="<hr/>";d+=c("strong","Response headers");d+="<table>";for(f=0;f<b.response.headers.length;f++)d+="<tr>",d+=c("td",b.response.headers[f].name),d+=c("td",b.response.headers[f].value),d+="</tr>";
var d=d+"</table>",d=d+"</td>",e=document.createElement("TR");e.innerHTML=d;$(a).after(e);b.info=e}v()};this.draw=function(b){this.el=l=b;google.visualization?n():(google.load("visualization","1",{packages:["corechart"]}),google.setOnLoadCallback(n));b={};b["#"+l+" table.harpy>tbody>tr"]={click:function(a,b){e.showInfo(b)}};Exos.enable([b,{window:{resize:function(){e.resize()}}}]);b=document.createElement("TABLE");b.className="harpy";b.innerHTML=a;document.getElementById(l).appendChild(b);setTimeout(this.resize,
1);$.tablesorter&&$(b).tablesorter({sortList:[[0,0]]})}}}}();
