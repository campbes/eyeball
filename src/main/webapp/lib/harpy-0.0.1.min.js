var Harpy=function(){function e(b){k[b]="function"===typeof Harpy[b]?Harpy[b](k):Harpy[b];return k[b]}function b(b){e(b);Harpy[b]=null;delete Harpy[b]}var k={};return{Viewer:null,Comparator:null,init:function(){b("util");b("render");b("harpify");Harpy.Viewer=e("Viewer");Harpy.Comparator=e("Comparator");Harpy.init=null;delete Harpy.init}}}();
Harpy.Comparator=function(e){return function(b,k){b=JSON.parse(b);k=JSON.parse(k);var g=e.harpify(b),h=e.harpify(k),a=g.stats,d=h.stats,f,g=["Metric","Primed cache","Uncached"],l={timings:[g,["Dom load",a.timing.onContentLoad/1E3,d.timing.onContentLoad/1E3],["Load",a.timing.onLoad/1E3,d.timing.onLoad/1E3],["Total",a.timing.total/1E3,d.timing.total/1E3]],requests:[g,["Requests",a.requests.uncached,d.requests.uncached]],download:[g,["Size",a.size.download/1024,d.size.download/1024]]};this.draw=function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          n,g){this.el=f=b;b=function(){var b;e.render.drawPieCharts(f,a,d);for(b in l)l.hasOwnProperty(b)&&e.render.drawBarChart(f,l[b])};n&&l[n]?b=function(){e.render.drawBarChart(f,l[n],g)}:n&&(b=function(){e.render.drawPieChart(f,a,d,n,g)});google.visualization?b():(google.load("visualization","1",{packages:["corechart"]}),google.setOnLoadCallback(b));return this}}};
Harpy.Viewer=function(e){return function(b){function k(){var d=$("#"+a+" th.timeline").width()/b.log.pages[0].harpy_info.time.total,n=$("#"+a+" table.harpy div"),f=$("#"+a+" table.harpy div.loadMarker"),g=$("#"+a+" table.harpy>tbody").height()+"px";n.each(function(){this.hasAttribute("data-start")&&(this.style.marginLeft=e.util.unitise(this,"data-start",d)+"px");this.hasAttribute("data-time")&&(this.style.width=e.util.unitise(this,"data-time",d)+"px")});f.each(function(){var a=0,b=0;this.hasAttribute("data-dom")&&
(a=e.util.unitise(this,"data-dom",d));this.hasAttribute("data-page")&&(b=e.util.unitise(this,"data-page",d)-a);this.style.marginLeft=a+"px";this.style.width=b+"px";this.style.height=g})}function g(){e.render.drawPieCharts(a,l)}var h=this,a=null;b=JSON.parse(b);var d=e.harpify(b);b=d.har;var f=d.entryCache,l=d.stats;this.resize=k;this.showInfo=function(a){var b=a.getAttribute("data-id"),b=f[b];if(b.info)b.info.style.display="none"===b.info.style.display?"table-row":"none",k();else{var d=document.createElement("TR");
    d.innerHTML=Harpy.Templates.info(b);$(a).after(d);b.info=d;k();return a}};this.draw=function(d){this.el=a=d;google.visualization?g():(google.load("visualization","1",{packages:["corechart"]}),google.setOnLoadCallback(g));d={};d["#"+a+" table.harpy>tbody>tr"]={click:function(a,b){h.showInfo(b)}};h.behaviours=[d,{window:{resize:function(){h.resize()}}}];Exos.enable(h.behaviours);Handlebars.registerHelper("trimmer",e.util.trimmer);Handlebars.registerHelper("format",e.util.format);Handlebars.registerPartial("timeline",
    Harpy.Templates.timeline);d=document.createElement("TABLE");d.innerHTML=Harpy.Templates.data(b);d.className="harpy";document.getElementById(a)&&document.getElementById(a).appendChild(d);setTimeout(this.resize,1);$.tablesorter&&$(d).tablesorter({sortList:[[0,0]]});return this};this.destroy=function(){Exos.remove(h.behaviours)}}};
Harpy.harpify=function(e){return function(b){var k={},g;g={time:{blocked:0,dns:0,connect:0,send:0,wait:0,receive:0},type:{image:0,html:0,js:0,css:0,text:0,other:0},uncached:{image:0,html:0,js:0,css:0,text:0,other:0},size:{cache:0,download:0},requests:{cached:0,uncached:0},timing:{onContentLoad:0,onLoad:0,total:0}};var h=b.log.pages[0].pageTimings;g.timing.onLoad=h.onLoad;g.timing.total=h.onLoad;g.timing.onContentLoad=h.onContentLoad||h.onLoad;var a=new Date(b.log.pages[0].startedDateTime),d,f,l,m,
    n,p,q=b.log.entries[0].request.url.split("://");q[1]&&(q=q[0]+"://"+q[1].split("/")[0]);for(d=0;d<b.log.entries.length;d++){f=b.log.entries[d];f.harpy_info={};k[d]=f;l=f.request.url;f.harpy_info.source=-1<l.indexOf(q)?"internal":"external";0<d&&(l=l.replace(b.log.entries[0].request.url,""));m=e.util.getMimetype(f.response.content.mimeType);n=(new Date(f.startedDateTime)).getTime()+f.time;n>a.getTime()+h.total&&(g.timing.total=n-a);for(p in f.timings)f.timings.hasOwnProperty(p)&&0<f.timings[p]&&(g.time[p]+=
    f.timings[p]);g.type[m]+=f.response.bodySize;g.uncached[m]+=f.response.bodySize;g.size.download+=f.response.bodySize;f.harpy_info.index=d+1;f.harpy_info.url=l;f.harpy_info.mimetype=m;"(cache)"===f.response.status?(f.harpy_info.cache="cache",g.requests.cached+=1):g.requests.uncached+=1;f.cache.hasOwnProperty("afterRequest")?(g.size.cache+=f.response.content.size,g.type[m]+=f.response.content.size,f.harpy_info.size=f.response.content.size):f.harpy_info.size=f.response.bodySize;f.harpy_info.startTime=
    new Date(f.startedDateTime)-a}h={};h.time=g.timing;h.size=g.size;b.log.pages[0].harpy_info=h;return{har:b,stats:g,entryCache:k}}};
Harpy.render=function(){function e(e,h,a,d,f){f=f||k[d];var l,m,n,p,q;if(h.hasOwnProperty(d)&&f){h=h[d];m=[["",""]];a&&(l=a[d],n=[["",""]]);for(p in h)h.hasOwnProperty(p)&&(m[m.length]=[p,0>h[p]?0:h[p]],l&&l.hasOwnProperty(p)&&(n[n.length]=[p,0>l[p]?0:l[p]]));for(q in b)b.hasOwnProperty(q)&&!f[q]&&(f[q]=b[q]);d=document.createElement("DIV");d.className="harpyChart";if(e=document.getElementById(e))e.getAttribute("data-height")&&(f.chartArea.height=e.getAttribute("data-height")),e.appendChild(d);e=
    google.visualization.arrayToDataTable(m);m=new google.visualization.PieChart(d);a&&(a=google.visualization.arrayToDataTable(n),e=m.computeDiff(a,e));m.draw(e,f)}return m}var b={pieSliceTextStyle:{color:"#000"},chartArea:{top:30,left:10,bottom:30,right:10,width:300},diff:{oldData:{opacity:0.7}},sliceVisibilityThreshold:0},k={time:{colors:"#d9534f #F63 #F96 #9C9 #FC6 #5cb85c".split(" "),title:"Time"},type:{colors:["#CCC","#FFB","#FBF","#BBF","#FBB"],title:"Content"},uncached:{colors:["#CCC","#FFB",
    "#FBF","#BBF","#FBB"],title:"Uncached content"},size:{colors:["#5cb85c","#d9534f"],title:"Cache profile"}};return{standardConfig:b,chartConfigs:k,drawPieChart:e,drawPieCharts:function(b,h,a,d){var f,k,m=[];for(f in h)h.hasOwnProperty(f)&&(k=e(b,h,a,f,d),m[m.length]=k);return m},drawBarChart:function(b,e,a){a=a||{colors:["#5cb85c","#d9534f"],legend:"none",hAxis:{maxValue:0}};var d=document.createElement("DIV");d.className="harpyChart harpyBarChart";document.getElementById(b)&&document.getElementById(b).appendChild(d);
    b=google.visualization.arrayToDataTable(e);d=new google.visualization.BarChart(d);d.draw(b,a);return d}}}();
Harpy.util=function(){return{getMimetype:function(e){e=e||"";return-1!==e.indexOf("image")?"image":-1!==e.indexOf("html")?"html":-1!==e.indexOf("javascript")?"js":-1!==e.indexOf("css")?"css":-1!==e.indexOf("text")?"text":"other"},format:function(e,b){switch(b){case "size":return 1024<e?(e=Math.round(e/102.4),e/10+" KB"):e+" B";case "time":return 1E3<e?(e=Math.round(e/10),e/100+" s"):e+" ms"}return e},trimmer:function(e,b,k){var g=e.length>b?"...":"";return k?g+(e.length>b?e.substr(e.length-b):e):
    e.substr(0,b)+g},unitise:function(e,b,k){return Math.floor(Number(e.getAttribute(b))*k)}}}();Harpy.init();this.Harpy=this.Harpy||{};this.Harpy.Templates=this.Harpy.Templates||{};
this.Harpy.Templates.data=Handlebars.template(function(e,b,k,g,h){this.compilerInfo=[4,">= 1.0.0"];k=this.merge(k,e.helpers);g=this.merge(g,e.partials);h=h||{};var a,d,f=this.escapeExpression,l=k.helperMissing,m=this;e=""+('<thead>\r\n    <tr>\r\n        <th></th>\r\n        <th>Method</th>\r\n        <th>URL</th>\r\n        <th>Status</th>\r\n        <th>Type</th>\r\n        <th>Size</th>\r\n        <th class="timeline">\r\n            <div class="loadMarker" data-dom="'+f((a=(a=(a=(a=(a=(a=b&&b.log,
    null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onContentLoad),"function"===typeof a?a.apply(b):a))+'" data-page="'+f((a=(a=(a=(a=(a=(a=b&&b.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onLoad),"function"===typeof a?a.apply(b):a))+'"></div>\r\n        </th>\r\n    </tr>\r\n</thead>\r\n<tbody>\r\n');if((d=k.each.call(b,(a=b&&b.log,
    null==a||!1===a?a:a.entries),{hash:{},inverse:m.noop,fn:m.program(1,function(a,b){var d,c,e;d=""+('\r\n    <tr data-id="'+f((c=(c=b,null==c||!1===c?c:c.index),"function"===typeof c?c.apply(a):c))+'" class="'+f((c=(c=a&&a.harpy_info,null==c||!1===c?c:c.mimetype),"function"===typeof c?c.apply(a):c))+" "+f((c=(c=a&&a.harpy_info,null==c||!1===c?c:c.cache),"function"===typeof c?c.apply(a):c))+" "+f((c=(c=a&&a.harpy_info,null==c||!1===c?c:c.source),"function"===typeof c?c.apply(a):c))+'">\r\n        <td>'+
        f((c=(c=a&&a.harpy_info,null==c||!1===c?c:c.index),"function"===typeof c?c.apply(a):c))+"</td>\r\n        <td>"+f((c=(c=a&&a.request,null==c||!1===c?c:c.method),"function"===typeof c?c.apply(a):c))+'</td>\r\n        <td class="url" title="'+f((c=(c=a&&a.harpy_info,null==c||!1===c?c:c.url),"function"===typeof c?c.apply(a):c))+'">');e={hash:{},data:b};d+=f((c=k.trimmer||a&&a.trimmer,c?c.call(a,(c=a&&a.harpy_info,null==c||!1===c?c:c.url),30,!0,e):l.call(a,"trimmer",(c=a&&a.harpy_info,null==c||!1===c?
        c:c.url),30,!0,e)))+'</td>\r\n        <td title="'+f((c=(c=a&&a.response,null==c||!1===c?c:c.status),"function"===typeof c?c.apply(a):c))+" "+f((c=(c=a&&a.response,null==c||!1===c?c:c.statusText),"function"===typeof c?c.apply(a):c))+'">'+f((c=(c=a&&a.response,null==c||!1===c?c:c.status),"function"===typeof c?c.apply(a):c))+'</td>\r\n        <td title="'+f((c=(c=(c=a&&a.response,null==c||!1===c?c:c.content),null==c||!1===c?c:c.mimeType),"function"===typeof c?c.apply(a):c))+'">'+f((c=(c=a&&a.harpy_info,
        null==c||!1===c?c:c.mimetype),"function"===typeof c?c.apply(a):c))+"</td>\r\n        <td>";e={hash:{},data:b};d+=f((c=k.format||a&&a.format,c?c.call(a,(c=a&&a.harpy_info,null==c||!1===c?c:c.size),"size",e):l.call(a,"format",(c=a&&a.harpy_info,null==c||!1===c?c:c.size),"size",e)))+'</td>\r\n        <td title="Blocked: '+f((c=(c=a&&a.timings,null==c||!1===c?c:c.blocked),"function"===typeof c?c.apply(a):c))+" ms, DNS: "+f((c=(c=a&&a.timings,null==c||!1===c?c:c.dns),"function"===typeof c?c.apply(a):c))+
        " ms, Connect: "+f((c=(c=a&&a.timings,null==c||!1===c?c:c.connect),"function"===typeof c?c.apply(a):c))+" ms, Send: "+f((c=(c=a&&a.timings,null==c||!1===c?c:c.send),"function"===typeof c?c.apply(a):c))+" ms, Wait: "+f((c=(c=a&&a.timings,null==c||!1===c?c:c.wait),"function"===typeof c?c.apply(a):c))+" ms, Receive: "+f((c=(c=a&&a.timings,null==c||!1===c?c:c.receive),"function"===typeof c?c.apply(a):c))+' ms">';if((c=m.invokePartial(g.timeline,"timeline",a,k,g,b))||0===c)d+=c;return d+"</td>\r\n    </tr>\r\n"},
    h),data:h}))||0===d)e+=d;e+='\r\n</tbody>\r\n<tfoot>\r\n    <tr class="total">\r\n        <td>'+f((a=(a=(a=b&&b.log,null==a||!1===a?a:a.entries),null==a||!1===a?a:a.length),"function"===typeof a?a.apply(b):a))+'</td>\r\n        <td colspan="4"></td>\r\n        <td>';d={hash:{},data:h};e+=f((a=k.format||b&&b.format,a?a.call(b,(a=(a=(a=(a=(a=b&&b.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.download),"size",d):l.call(b,
    "format",(a=(a=(a=(a=(a=b&&b.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.download),"size",d)))+"</td>\r\n        <td>\r\n            (";d={hash:{},data:h};e+=f((a=k.format||b&&b.format,a?a.call(b,(a=(a=(a=(a=(a=b&&b.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.cache),"size",d):l.call(b,"format",(a=(a=(a=(a=(a=b&&b.log,null==
    a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.cache),"size",d)))+' from cache)\r\n            <span title="DOM: ';d={hash:{},data:h};e+=f((a=k.format||b&&b.format,a?a.call(b,(a=(a=(a=(a=(a=b&&b.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onContentLoad),"time",d):l.call(b,"format",(a=(a=(a=(a=(a=b&&b.log,null==a||!1===a?a:a.pages),null==
    a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onContentLoad),"time",d)))+", Page: ";d={hash:{},data:h};e+=f((a=k.format||b&&b.format,a?a.call(b,(a=(a=(a=(a=(a=b&&b.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onLoad),"time",d):l.call(b,"format",(a=(a=(a=(a=(a=b&&b.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===
    a?a:a.time),null==a||!1===a?a:a.onLoad),"time",d)))+'">';d={hash:{},data:h};return e+=f((a=k.format||b&&b.format,a?a.call(b,(a=(a=(a=(a=(a=b&&b.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.total),"time",d):l.call(b,"format",(a=(a=(a=(a=(a=b&&b.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.total),"time",d)))+"</span>\r\n        </td>\r\n    </tr>\r\n</tfoot>"});
this.Harpy.Templates.info=Handlebars.template(function(e,b,k,g,h){function a(a,b){var d,e;d="\r\n            <tr>\r\n                <td>";(e=k.name)?e=e.call(a,{hash:{},data:b}):(e=a&&a.name,e=typeof e===f?e.call(a,{hash:{},data:b}):e);d+=l(e)+"</td>\r\n                <td>";(e=k.value)?e=e.call(a,{hash:{},data:b}):(e=a&&a.value,e=typeof e===f?e.call(a,{hash:{},data:b}):e);return d+=l(e)+"</td>\r\n            </tr>\r\n        "}this.compilerInfo=[4,">= 1.0.0"];k=this.merge(k,e.helpers);h=h||{};var d,
    f="function",l=this.escapeExpression;e=""+('<td></td>\r\n<td class="info" colspan="6">\r\n    <a href="'+l((d=(d=(d=b&&b.entry,null==d||!1===d?d:d.request),null==d||!1===d?d:d.url),typeof d===f?d.apply(b):d))+'" target="_blank">\r\n        <strong>'+l((d=(d=b&&b.request,null==d||!1===d?d:d.url),typeof d===f?d.apply(b):d))+"</strong>\r\n    </a>\r\n    <br/>\r\n    "+l((d=(d=(d=b&&b.response,null==d||!1===d?d:d.content),null==d||!1===d?d:d.mimeType),typeof d===f?d.apply(b):d))+'\r\n    <hr/>\r\n    <strong>Timings</strong>\r\n    <dl>\r\n        <dt>Blocked</dt>\r\n        <dd class="blocked">'+
    l((d=(d=b&&b.timings,null==d||!1===d?d:d.blocked),typeof d===f?d.apply(b):d))+' ms</dd>\r\n        <dt>DNS</dt>\r\n        <dd class="dns">'+l((d=(d=b&&b.timings,null==d||!1===d?d:d.dns),typeof d===f?d.apply(b):d))+' ms</dd>\r\n        <dt>Connect</dt>\r\n        <dd class="connect">'+l((d=(d=b&&b.timings,null==d||!1===d?d:d.connect),typeof d===f?d.apply(b):d))+' ms</dd>\r\n        <dt>Send</dt>\r\n        <dd class="send">'+l((d=(d=b&&b.timings,null==d||!1===d?d:d.send),typeof d===f?d.apply(b):d))+
    ' ms</dd>\r\n        <dt>Wait</dt>\r\n        <dd class="wait">'+l((d=(d=b&&b.timings,null==d||!1===d?d:d.wait),typeof d===f?d.apply(b):d))+' ms</dd>\r\n        <dt>Receive</dt>\r\n        <dd class="receive">'+l((d=(d=b&&b.timings,null==d||!1===d?d:d.receive),typeof d===f?d.apply(b):d))+" ms</dd>\r\n    </dl>\r\n    <hr/>\r\n    <strong>Request headers</strong>\r\n    <table>\r\n        ");if((g=k.each.call(b,(d=b&&b.request,null==d||!1===d?d:d.headers),{hash:{},inverse:this.noop,fn:this.program(1,
    a,h),data:h}))||0===g)e+=g;e+="\r\n    </table>\r\n    <hr/>\r\n    <strong>Response headers</strong>\r\n    <table>\r\n        ";if((g=k.each.call(b,(d=b&&b.response,null==d||!1===d?d:d.headers),{hash:{},inverse:this.noop,fn:this.program(1,a,h),data:h}))||0===g)e+=g;return e+"\r\n    </table>\r\n    <hr/>\r\n</td>"});
this.Harpy.Templates.timeline=Handlebars.template(function(e,b,k,g,h){this.compilerInfo=[4,">= 1.0.0"];this.merge(k,e.helpers);var a;e=this.escapeExpression;return b=""+('<div class="blocked" data-time="'+e((a=(a=b&&b.timings,null==a||!1===a?a:a.blocked),"function"===typeof a?a.apply(b):a))+'" data-start="'+e((a=(a=b&&b.harpy_info,null==a||!1===a?a:a.startTime),"function"===typeof a?a.apply(b):a))+'"></div>\r\n<div class="dns" data-time="'+e((a=(a=b&&b.timings,null==a||!1===a?a:a.dns),"function"===
    typeof a?a.apply(b):a))+'"></div>\r\n<div class="connect" data-time="'+e((a=(a=b&&b.timings,null==a||!1===a?a:a.connect),"function"===typeof a?a.apply(b):a))+'"></div>\r\n<div class="send" data-time="'+e((a=(a=b&&b.timings,null==a||!1===a?a:a.send),"function"===typeof a?a.apply(b):a))+'"></div>\r\n<div class="wait" data-time="'+e((a=(a=b&&b.timings,null==a||!1===a?a:a.wait),"function"===typeof a?a.apply(b):a))+'"></div>\r\n<div class="receive" data-time="'+e((a=(a=b&&b.timings,null==a||!1===a?a:a.receive),
    "function"===typeof a?a.apply(b):a))+'"></div>')});
