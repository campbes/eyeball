var Harpy=function(){function e(c){h[c]="function"===typeof Harpy[c]?Harpy[c](h):Harpy[c];return h[c]}function c(c){e(c);Harpy[c]=null;delete Harpy[c]}var h={};return{Viewer:null,Comparator:null,init:function(){c("util");c("render");c("harpify");Harpy.Viewer=e("Viewer");Harpy.Comparator=e("Comparator");Harpy.init=null;delete Harpy.init}}}();
Harpy.Comparator=function(e){return function(c,h){c=JSON.parse(c);h=JSON.parse(h);var g=e.harpify(c),k=e.harpify(h),a=g.stats,d=k.stats,f,g=["Metric","Primed cache","Uncached"],l={timings:[g,["Dom load",a.timing.onContentLoad/1E3,d.timing.onContentLoad/1E3],["Load",a.timing.onLoad/1E3,d.timing.onLoad/1E3],["Total",a.timing.total/1E3,d.timing.total/1E3]],requests:[g,["Requests",a.requests.uncached,d.requests.uncached]],download:[g,["Size",a.size.download/1024,d.size.download/1024]]};this.draw=function(c,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          n,g){this.el=f=c;c=function(){var c=g,b,c=c||{};e.render.drawPieCharts(f,a,d,c.pie);for(b in l)l.hasOwnProperty(b)&&e.render.drawBarChart(f,l[b],c.bar)};n&&l[n]?c=function(){e.render.drawBarChart(f,l[n],g)}:n&&(c=function(){e.render.drawPieChart(f,a,d,n,g)});google.visualization?c():(google.load("visualization","1",{packages:["corechart"]}),google.setOnLoadCallback(c));return this}}};
Harpy.Viewer=function(e){return function(c){function h(){var a=$("#"+k+" th.timeline").width()/c.log.pages[0].harpy_info.time.total,d=$("#"+k+" table.harpy div"),n=$("#"+k+" table.harpy div.loadMarker"),f=$("#"+k+" table.harpy>tbody").height()+"px";d.each(function(){this.hasAttribute("data-start")&&(this.style.marginLeft=e.util.unitise(this,"data-start",a)+"px");this.hasAttribute("data-time")&&(this.style.width=e.util.unitise(this,"data-time",a)+"px")});n.each(function(){var c=0,b=0;this.hasAttribute("data-dom")&&
(c=e.util.unitise(this,"data-dom",a));this.hasAttribute("data-page")&&(b=e.util.unitise(this,"data-page",a)-c);this.style.marginLeft=c+"px";this.style.width=b+"px";this.style.height=f})}var g=this,k=null;c=JSON.parse(c);var a=e.harpify(c);c=a.har;var d=a.entryCache,f=a.stats;this.resize=h;this.showInfo=function(a){var c=a.getAttribute("data-id"),c=d[c];if(c.info)c.info.style.display="none"===c.info.style.display?"table-row":"none",h();else{var n=document.createElement("TR");n.innerHTML=Harpy.Templates.info(c);
    $(a).after(n);c.info=n;h();return a}};this.draw=function(a,d){function n(){e.render.drawPieCharts(k,f,null,d)}this.el=k=a;google.visualization?n():(google.load("visualization","1",{packages:["corechart"]}),google.setOnLoadCallback(n));var h={};h["#"+k+" table.harpy>tbody>tr"]={click:function(a,b){g.showInfo(b)}};g.behaviours=[h,{window:{resize:function(){g.resize()}}}];Exos.enable(g.behaviours);Handlebars.registerHelper("trimmer",e.util.trimmer);Handlebars.registerHelper("format",e.util.format);Handlebars.registerPartial("timeline",
    Harpy.Templates.timeline);h=document.createElement("TABLE");h.innerHTML=Harpy.Templates.data(c);h.className="harpy";document.getElementById(k)&&document.getElementById(k).appendChild(h);setTimeout(this.resize,1);$.tablesorter&&$(h).tablesorter({sortList:[[0,0]]});return this};this.destroy=function(){Exos.remove(g.behaviours)}}};
Harpy.harpify=function(e){return function(c){var h={},g;g={time:{blocked:0,dns:0,connect:0,send:0,wait:0,receive:0},type:{image:0,html:0,js:0,css:0,text:0,other:0},uncached:{image:0,html:0,js:0,css:0,text:0,other:0},size:{cache:0,download:0},requests:{cached:0,uncached:0},timing:{onContentLoad:0,onLoad:0,total:0}};var k=c.log.pages[0].pageTimings;g.timing.onLoad=k.onLoad;g.timing.total=k.onLoad;g.timing.onContentLoad=k.onContentLoad||k.onLoad;var a=new Date(c.log.pages[0].startedDateTime),d,f,l,m,
    n,p,q=c.log.entries[0].request.url.split("://");q[1]&&(q=q[0]+"://"+q[1].split("/")[0]);for(d=0;d<c.log.entries.length;d++){f=c.log.entries[d];f.harpy_info={};h[d]=f;l=f.request.url;f.harpy_info.source=-1<l.indexOf(q)?"internal":"external";0<d&&(l=l.replace(c.log.entries[0].request.url,""));m=e.util.getMimetype(f.response.content.mimeType);n=(new Date(f.startedDateTime)).getTime()+f.time;n>a.getTime()+k.total&&(g.timing.total=n-a);for(p in f.timings)f.timings.hasOwnProperty(p)&&0<f.timings[p]&&(g.time[p]+=
    f.timings[p]);g.type[m]+=f.response.bodySize;g.uncached[m]+=f.response.bodySize;g.size.download+=f.response.bodySize;f.harpy_info.index=d+1;f.harpy_info.url=l;f.harpy_info.mimetype=m;"(cache)"===f.response.status?(f.harpy_info.cache="cache",g.requests.cached+=1):g.requests.uncached+=1;f.cache.hasOwnProperty("afterRequest")?(g.size.cache+=f.response.content.size,g.type[m]+=f.response.content.size,f.harpy_info.size=f.response.content.size):f.harpy_info.size=f.response.bodySize;f.harpy_info.startTime=
    new Date(f.startedDateTime)-a}k={};k.time=g.timing;k.size=g.size;c.log.pages[0].harpy_info=k;return{har:c,stats:g,entryCache:h}}};
Harpy.render=function(){function e(e,k,a,d,f){f=f?f[d]:h[d];var l,m,n,p,q;if(k.hasOwnProperty(d)&&f){k=k[d];m=[["",""]];a&&(l=a[d],n=[["",""]]);for(p in k)k.hasOwnProperty(p)&&(m[m.length]=[p,0>k[p]?0:k[p]],l&&l.hasOwnProperty(p)&&(n[n.length]=[p,0>l[p]?0:l[p]]));for(q in c)c.hasOwnProperty(q)&&!f[q]&&(f[q]=c[q]);d=document.createElement("DIV");d.className="harpyChart";if(e=document.getElementById(e))e.getAttribute("data-height")&&(f.chartArea.height=e.getAttribute("data-height")),e.appendChild(d);
    e=google.visualization.arrayToDataTable(m);m=new google.visualization.PieChart(d);a&&(a=google.visualization.arrayToDataTable(n),e=m.computeDiff(a,e));m.draw(e,f)}return m}var c={pieSliceTextStyle:{color:"#000"},chartArea:{top:30,left:10,bottom:30,right:10,width:300},diff:{oldData:{opacity:0.7}},sliceVisibilityThreshold:0},h={time:{colors:"#d9534f #F63 #F96 #9C9 #FC6 #5cb85c".split(" "),title:"Time"},type:{colors:["#CCC","#FFB","#FBF","#BBF","#FBB"],title:"Content"},uncached:{colors:["#CCC","#FFB",
    "#FBF","#BBF","#FBB"],title:"Uncached content"},size:{colors:["#5cb85c","#d9534f"],title:"Cache profile"}};return{standardConfig:c,chartConfigs:h,drawPieChart:e,drawPieCharts:function(c,k,a,d){var f,h,m=[];for(f in k)k.hasOwnProperty(f)&&(h=e(c,k,a,f,d),m[m.length]=h);return m},drawBarChart:function(c,e,a){a=a||{colors:["#5cb85c","#d9534f"],legend:"none",hAxis:{maxValue:0}};var d=document.createElement("DIV");d.className="harpyChart harpyBarChart";document.getElementById(c)&&document.getElementById(c).appendChild(d);
    c=google.visualization.arrayToDataTable(e);d=new google.visualization.BarChart(d);d.draw(c,a);return d}}}();
Harpy.util=function(){return{getMimetype:function(e){e=e||"";return-1!==e.indexOf("image")?"image":-1!==e.indexOf("html")?"html":-1!==e.indexOf("javascript")?"js":-1!==e.indexOf("css")?"css":-1!==e.indexOf("text")?"text":"other"},format:function(e,c){switch(c){case "size":return 1024<e?(e=Math.round(e/102.4),e/10+" KB"):e+" B";case "time":return 1E3<e?(e=Math.round(e/10),e/100+" s"):e+" ms"}return e},trimmer:function(e,c,h){var g=e.length>c?"...":"";return h?g+(e.length>c?e.substr(e.length-c):e):
    e.substr(0,c)+g},unitise:function(e,c,h){return Math.floor(Number(e.getAttribute(c))*h)}}}();Harpy.init();this.Harpy=this.Harpy||{};this.Harpy.Templates=this.Harpy.Templates||{};
this.Harpy.Templates.data=Handlebars.template(function(e,c,h,g,k){this.compilerInfo=[4,">= 1.0.0"];h=this.merge(h,e.helpers);g=this.merge(g,e.partials);k=k||{};var a,d,f=this.escapeExpression,l=h.helperMissing,m=this;e=""+('<thead>\r\n    <tr>\r\n        <th></th>\r\n        <th>Method</th>\r\n        <th>URL</th>\r\n        <th>Status</th>\r\n        <th>Type</th>\r\n        <th>Size</th>\r\n        <th class="timeline">\r\n            <div class="loadMarker" data-dom="'+f((a=(a=(a=(a=(a=(a=c&&c.log,
        null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onContentLoad),"function"===typeof a?a.apply(c):a))+'" data-page="'+f((a=(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onLoad),"function"===typeof a?a.apply(c):a))+'"></div>\r\n        </th>\r\n    </tr>\r\n</thead>\r\n<tbody>\r\n');if((d=h.each.call(c,(a=c&&c.log,
        null==a||!1===a?a:a.entries),{hash:{},inverse:m.noop,fn:m.program(1,function(a,c){var d,b,e;d=""+('\r\n    <tr data-id="'+f((b=(b=c,null==b||!1===b?b:b.index),"function"===typeof b?b.apply(a):b))+'" class="'+f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.mimetype),"function"===typeof b?b.apply(a):b))+" "+f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.cache),"function"===typeof b?b.apply(a):b))+" "+f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.source),"function"===typeof b?b.apply(a):b))+'">\r\n        <td>'+
        f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.index),"function"===typeof b?b.apply(a):b))+"</td>\r\n        <td>"+f((b=(b=a&&a.request,null==b||!1===b?b:b.method),"function"===typeof b?b.apply(a):b))+'</td>\r\n        <td class="url" title="'+f((b=(b=a&&a.harpy_info,null==b||!1===b?b:b.url),"function"===typeof b?b.apply(a):b))+'">');e={hash:{},data:c};d+=f((b=h.trimmer||a&&a.trimmer,b?b.call(a,(b=a&&a.harpy_info,null==b||!1===b?b:b.url),30,!0,e):l.call(a,"trimmer",(b=a&&a.harpy_info,null==b||!1===b?
        b:b.url),30,!0,e)))+'</td>\r\n        <td title="'+f((b=(b=a&&a.response,null==b||!1===b?b:b.status),"function"===typeof b?b.apply(a):b))+" "+f((b=(b=a&&a.response,null==b||!1===b?b:b.statusText),"function"===typeof b?b.apply(a):b))+'">'+f((b=(b=a&&a.response,null==b||!1===b?b:b.status),"function"===typeof b?b.apply(a):b))+'</td>\r\n        <td title="'+f((b=(b=(b=a&&a.response,null==b||!1===b?b:b.content),null==b||!1===b?b:b.mimeType),"function"===typeof b?b.apply(a):b))+'">'+f((b=(b=a&&a.harpy_info,
            null==b||!1===b?b:b.mimetype),"function"===typeof b?b.apply(a):b))+"</td>\r\n        <td>";e={hash:{},data:c};d+=f((b=h.format||a&&a.format,b?b.call(a,(b=a&&a.harpy_info,null==b||!1===b?b:b.size),"size",e):l.call(a,"format",(b=a&&a.harpy_info,null==b||!1===b?b:b.size),"size",e)))+'</td>\r\n        <td title="Blocked: '+f((b=(b=a&&a.timings,null==b||!1===b?b:b.blocked),"function"===typeof b?b.apply(a):b))+" ms, DNS: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.dns),"function"===typeof b?b.apply(a):b))+
        " ms, Connect: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.connect),"function"===typeof b?b.apply(a):b))+" ms, Send: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.send),"function"===typeof b?b.apply(a):b))+" ms, Wait: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.wait),"function"===typeof b?b.apply(a):b))+" ms, Receive: "+f((b=(b=a&&a.timings,null==b||!1===b?b:b.receive),"function"===typeof b?b.apply(a):b))+' ms">';if((b=m.invokePartial(g.timeline,"timeline",a,h,g,c))||0===b)d+=b;return d+"</td>\r\n    </tr>\r\n"},
    k),data:k}))||0===d)e+=d;e+='\r\n</tbody>\r\n<tfoot>\r\n    <tr class="total">\r\n        <td>'+f((a=(a=(a=c&&c.log,null==a||!1===a?a:a.entries),null==a||!1===a?a:a.length),"function"===typeof a?a.apply(c):a))+'</td>\r\n        <td colspan="4"></td>\r\n        <td>';d={hash:{},data:k};e+=f((a=h.format||c&&c.format,a?a.call(c,(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.download),"size",d):l.call(c,
    "format",(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.download),"size",d)))+"</td>\r\n        <td>\r\n            (";d={hash:{},data:k};e+=f((a=h.format||c&&c.format,a?a.call(c,(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.cache),"size",d):l.call(c,"format",(a=(a=(a=(a=(a=c&&c.log,null==
    a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.size),null==a||!1===a?a:a.cache),"size",d)))+' from cache)\r\n            <span title="DOM: ';d={hash:{},data:k};e+=f((a=h.format||c&&c.format,a?a.call(c,(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onContentLoad),"time",d):l.call(c,"format",(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==
    a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onContentLoad),"time",d)))+", Page: ";d={hash:{},data:k};e+=f((a=h.format||c&&c.format,a?a.call(c,(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.onLoad),"time",d):l.call(c,"format",(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===
    a?a:a.time),null==a||!1===a?a:a.onLoad),"time",d)))+'">';d={hash:{},data:k};return e+=f((a=h.format||c&&c.format,a?a.call(c,(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.total),"time",d):l.call(c,"format",(a=(a=(a=(a=(a=c&&c.log,null==a||!1===a?a:a.pages),null==a||!1===a?a:a[0]),null==a||!1===a?a:a.harpy_info),null==a||!1===a?a:a.time),null==a||!1===a?a:a.total),"time",d)))+"</span>\r\n        </td>\r\n    </tr>\r\n</tfoot>"});
this.Harpy.Templates.info=Handlebars.template(function(e,c,h,g,k){function a(a,c){var d,e;d="\r\n            <tr>\r\n                <td>";(e=h.name)?e=e.call(a,{hash:{},data:c}):(e=a&&a.name,e=typeof e===f?e.call(a,{hash:{},data:c}):e);d+=l(e)+"</td>\r\n                <td>";(e=h.value)?e=e.call(a,{hash:{},data:c}):(e=a&&a.value,e=typeof e===f?e.call(a,{hash:{},data:c}):e);return d+=l(e)+"</td>\r\n            </tr>\r\n        "}this.compilerInfo=[4,">= 1.0.0"];h=this.merge(h,e.helpers);k=k||{};var d,
    f="function",l=this.escapeExpression;e=""+('<td></td>\r\n<td class="info" colspan="6">\r\n    <a href="'+l((d=(d=(d=c&&c.entry,null==d||!1===d?d:d.request),null==d||!1===d?d:d.url),typeof d===f?d.apply(c):d))+'" target="_blank">\r\n        <strong>'+l((d=(d=c&&c.request,null==d||!1===d?d:d.url),typeof d===f?d.apply(c):d))+"</strong>\r\n    </a>\r\n    <br/>\r\n    "+l((d=(d=(d=c&&c.response,null==d||!1===d?d:d.content),null==d||!1===d?d:d.mimeType),typeof d===f?d.apply(c):d))+'\r\n    <hr/>\r\n    <strong>Timings</strong>\r\n    <dl>\r\n        <dt>Blocked</dt>\r\n        <dd class="blocked">'+
    l((d=(d=c&&c.timings,null==d||!1===d?d:d.blocked),typeof d===f?d.apply(c):d))+' ms</dd>\r\n        <dt>DNS</dt>\r\n        <dd class="dns">'+l((d=(d=c&&c.timings,null==d||!1===d?d:d.dns),typeof d===f?d.apply(c):d))+' ms</dd>\r\n        <dt>Connect</dt>\r\n        <dd class="connect">'+l((d=(d=c&&c.timings,null==d||!1===d?d:d.connect),typeof d===f?d.apply(c):d))+' ms</dd>\r\n        <dt>Send</dt>\r\n        <dd class="send">'+l((d=(d=c&&c.timings,null==d||!1===d?d:d.send),typeof d===f?d.apply(c):d))+
    ' ms</dd>\r\n        <dt>Wait</dt>\r\n        <dd class="wait">'+l((d=(d=c&&c.timings,null==d||!1===d?d:d.wait),typeof d===f?d.apply(c):d))+' ms</dd>\r\n        <dt>Receive</dt>\r\n        <dd class="receive">'+l((d=(d=c&&c.timings,null==d||!1===d?d:d.receive),typeof d===f?d.apply(c):d))+" ms</dd>\r\n    </dl>\r\n    <hr/>\r\n    <strong>Request headers</strong>\r\n    <table>\r\n        ");if((g=h.each.call(c,(d=c&&c.request,null==d||!1===d?d:d.headers),{hash:{},inverse:this.noop,fn:this.program(1,
    a,k),data:k}))||0===g)e+=g;e+="\r\n    </table>\r\n    <hr/>\r\n    <strong>Response headers</strong>\r\n    <table>\r\n        ";if((g=h.each.call(c,(d=c&&c.response,null==d||!1===d?d:d.headers),{hash:{},inverse:this.noop,fn:this.program(1,a,k),data:k}))||0===g)e+=g;return e+"\r\n    </table>\r\n    <hr/>\r\n</td>"});
this.Harpy.Templates.timeline=Handlebars.template(function(e,c,h,g,k){this.compilerInfo=[4,">= 1.0.0"];this.merge(h,e.helpers);var a;e=this.escapeExpression;return c=""+('<div class="blocked" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.blocked),"function"===typeof a?a.apply(c):a))+'" data-start="'+e((a=(a=c&&c.harpy_info,null==a||!1===a?a:a.startTime),"function"===typeof a?a.apply(c):a))+'"></div>\r\n<div class="dns" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.dns),"function"===
    typeof a?a.apply(c):a))+'"></div>\r\n<div class="connect" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.connect),"function"===typeof a?a.apply(c):a))+'"></div>\r\n<div class="send" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.send),"function"===typeof a?a.apply(c):a))+'"></div>\r\n<div class="wait" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.wait),"function"===typeof a?a.apply(c):a))+'"></div>\r\n<div class="receive" data-time="'+e((a=(a=c&&c.timings,null==a||!1===a?a:a.receive),
        "function"===typeof a?a.apply(c):a))+'"></div>')});
