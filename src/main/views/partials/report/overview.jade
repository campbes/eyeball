include ../../test
include ../../report

div.container.table-responsive(ng-controller='ReportOverviewCtrl')

    mixin test
    mixin tabs('{{report}}')

    mixin filterInfo
    table#results.table.table-striped.table-condensed(data-expanded-locked="{{resultsTable.expanded}}")
        mixin reportHeaders
        tbody(ng-hide="reportView === 'chart'")
            mixin reportTotals
            mixin reportLoader
        tbody(ng-repeat = 'resGroup in resultsTable.results', ng-hide="reportView === 'chart'")
            tr.resultGroup(ng-init='r = resGroup.data')
                mixin reportFields(true)
                td(ng-repeat='f in fields',class='text-center grade{{getVal(r.metrics[f.tool].grades,f.metric)}}',data-type='grades',data-value='{{getVal(r.metrics[f.tool].grades,f.metric)}}',ng-mouseenter='setPopoverContent({metrics:r.metrics[f.tool],tool:f.tool})',ng-mouseleave='setPopoverContent()')
                    a(href="#/detail/:{{r._id}}?anchor={{f.tool}}")
                        span.badge {{getVal(r.metrics[f.tool].grades,f.metric)}}
            tr(ng-if='r.busy')
                td(colspan="8")
                    div.loader
                    |&nbsp; Updating results...
            tr(ng-repeat='r in resGroup.results',ng-if='$index > 0')
                mixin reportFields
                td(ng-repeat='f in fields',class='text-center grade{{getVal(r.metrics[f.tool].grades,f.metric)}}',data-type='grades',data-value='{{getVal(r.metrics[f.tool].grades,f.metric)}}',ng-mouseenter='setPopoverContent({metrics:r.metrics[f.tool],tool:f.tool})',ng-mouseleave='setPopoverContent()')
                    a(href="#/detail/:{{r._id}}?anchor={{f.tool}}")
                        span.badge {{getVal(r.metrics[f.tool].grades,f.metric)}}
        mixin reportFooters
    mixin charts
    mixin reportPager

    div#popoverContent.ng-hide
        ul.list-group
            li(ng-repeat='f in fieldConfig[popoverContent.tool].items', class='list-group-item {{($first ? "grade" + getVal(popoverContent.metrics.grades,f.metric) :"" )}}') {{f.name}}&nbsp;
                span(class='badge grade{{getVal(popoverContent.metrics.grades,f.metric)}}') {{getVal(popoverContent.metrics.grades,f.metric)}}

    mixin filter
